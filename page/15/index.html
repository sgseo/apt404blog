<html>

<head>
    <meta charset="utf-8">
    
    <title>APT404-不疯不魔怎么活</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon/favicon.ico">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/tagplugins.css">
    <link rel="stylesheet" href="/css/highlight.css">
    


    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="APT404-不疯不魔怎么活" type="application/atom+xml" />
    
</head>

<body>
  <div class="blog-header">
   <a id="menu-nav-icon"><img src="/image/menu.png"/></a>
   <div class="nav-container">
     <nav id="main-nav">
       
         <a class="main-nav-link" href="/">Home</a>
       
         <a class="main-nav-link" href="/archives">Archives</a>
       
     </nav>
   </div>
   <!--
   <div id="search-form-wrap">
     <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://apt404.github.io"></form>
   </div>
 -->
    <h1 class="blog-title">APT404-不疯不魔怎么活</h1>
    <p class="lead blog-description">在接下来的余生中,只做一件事,从 0 到 1</p>
</div>

  <div id='main-part'>
      
    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/19/inside-method/">Web渗透第一步之信息搜集  [ 找目标内网入口 ]</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-19
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 为什么要找内网入口:<br>&nbsp;&nbsp;&nbsp;&nbsp;我们渗透的最终目的大多数都是目标内网,有些核心敏感数据(比如,个人机上的一些数据),我们从边界机器是拿不到的,所以,只能深入内部,当然,这里所指的内部文件数据,并不仅限于数据库,邮件这类数据,可能由于各种各样的需求,我们还需要某些个人的数据或者组织的各种业务数据,技术的各种数据等等,一般情况下,渗透web的目的,很大程度上也是希望能从web边界直接进入到目标内部(内网),对于apt来讲,价值比较高的东西基本也全部在内部,不得不承认的是,有时候公开信息调研确实也能找到部分敏感信息,但那个含金量和时效性就远远不如内网中的了,至于如何深入到目标内部,很大程度上也取决于,我们能不能尽可能多的找到目标可能的内网入口</p>
<p>0x02 第一种,通过vpn进入目标内网[一般都会提供一个web端的443端口表单验证]:<br>&nbsp;&nbsp;&nbsp;&nbsp;vpn,想必大家都已经非常熟悉了,在前面也已经详细说明过它的用途,除了能帮我们翻墙当跳板之外,对于一些大型目标组织或是跨国公司,他们大部分都会选择利用vpn的方式来协作办公,通过vpn在公网上开辟一条专有通道,以方便公司内部的各种业务处理,但有个前提,你要想进入这条通道,必须有正确的vpn账号密码和vpn服务器地址,登陆成功后,才能处在目标的内网中,重点也就在这里,怎么搞到目标的vpn账号密码呢,嘿嘿……方法比较多,例如,发信钓鱼,搜集目标泄露过的各种配置文件,社工撞库……</p>
<p>0x03 利用各类邮件程序自身的漏洞尝试从web边界进入目标内网<br>&nbsp;&nbsp;&nbsp;&nbsp;下面就简单介绍一种常见的web邮件程序,[这里为什么一定要是邮件程序呢,不同于普通的web网站,普通的web服务器有时候即使拿到shell,但有可能机器并不在内网或者该机器上根本没有内网网卡,但邮件服务器一般都被会用来处理内部实际业务,从个人经验来看,web邮件程序的机器,绝大部分都在内网]:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;owa 微软自家的exchange服务,企业为了便于统一协作管理,一般都会直接把exchange服务部署在域内,邮箱名称和邮箱密码大部分也直接是域内的系统账号密码,可以直接拿来登陆域内系统,当然,vpn也是可以尝试的,关键还是看目标具体是怎么部署的了,至于,如何搞到目标的owa的账号密码,嘿嘿……后面再总结吧,包括命令行邮件导出成pst文件,如果目标部署的有exchange server 一般直接访问下/owa/auth即可看到,服务被部署好以后管理员没有特殊情况基本就不怎么会关注/owa/auth目录下的文件了,所以当你拿到权限后,在这儿放个webshell,还是很靠谱的,一般都是web的443端口,另外,对于owa本身几乎是没什么漏洞的</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">owa的一般入口如下<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/remote.bmtjfa.com.au/owa</span><span class="regexp">/auth/logon</span>.aspx机器在域内的情况</span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/mail.advancedptsm.com/owa</span><span class="regexp">/auth/logon</span>.aspx机器不在域内的情况</span><br><span class="line"></span><br><span class="line">如果没有删的话,可以访问下面的路径爆出服务器信息<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/mail.xxx.com/owa</span><span class="regexp">/auth/test</span>.aspx</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mirapoint邮件系统<span class="symbol">:</span></span><br><span class="line">ShellShock漏洞,漏洞地址如下<span class="symbol">:</span></span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/xxxx.com/cgi</span>-bin/search.cgi</span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/xxxx.com/cgi</span>-bin/madmin.cgi</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KerioConnect 邮件系统<span class="symbol">:</span></span><br><span class="line">一般后台只能内网访问,入口如下<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/mail.xxx.com:4040/admin</span><span class="regexp">/login/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Zimbra 邮件系统: </span><br><span class="line">本地包含,入口<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/webmail.xxx.com:7071/zimbra</span>Admin/</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看zimbra版本<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/webmail.xxx.com/help</span><span class="regexp">/zh_CN/standard</span><span class="regexp">/version.htm</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Atmail 邮件系统: </span><br><span class="line">敏感信息泄露问题[数据库账号密码]<span class="symbol">:</span></span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.xxx.com/config</span><span class="regexp">/dbconfig.ini</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Lotus Domino <span class="symbol">Webmail:</span></span><br><span class="line">越权访问,<span class="symbol">inurl:</span>.nsf/WebHelp/!OpenPage</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TurboMail邮件系统: </span><br><span class="line">默认配置不当可进入任意邮箱,默认有四个root域账号,一个管理员,三个普通用户</span><br><span class="line">由于设置缺陷,导致普通用户可以查看任意用户的密码</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">U-<span class="symbol">mail:</span></span><br><span class="line">sql注入,可写shell</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">WinMail:</span></span><br><span class="line">非授权访问/权限绕过</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExtMail <span class="symbol">:</span></span><br><span class="line">老版本注入</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SquirrelMail</span><br></pre></td></tr></table></figure>
<p>0x04 找目标的oa系统或者图书馆之类的网站以及各种边界网络设备的web管理端[一般像这些东西跟内网的联系比较大]:<br>&nbsp;&nbsp;&nbsp;&nbsp;oa本来就是为了方便员工远程办公,处理公司各种业务用的,但,这也给我们提供了通往目标内部的入口至于,为什么非要选则图书馆,目的很显然,既然是图书馆,你肯定会想到内部的什么图书管理系统,实际经验也证明,大多数图书馆的站,都会处在内网中找各种网络设备的web管理端,主要是想登进去以后,看看有没有可以上传shell的地方,也许可以利用得到</p>
<p>0x05 在你能力足够的情况下,直接搞路由也是可以的[比如,cisco,端口镜像,抓包分析,说实话自己对路由并不是非常擅长]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">路由作为一种边界设备,搞它的意义就不用再多说了吧</span><br></pre></td></tr></table></figure></p>
<p>0x06 暴露在边界的目标打印机,智能点儿的打印机都会自带一些web服务[通常是java]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打印机,就更不用说了,典型的内部设备,一般是先找到配置管理界面,部署war包</span><br></pre></td></tr></table></figure></p>
<p>0x07 如果实在外部搞不定,条件允许的情况下,尝试实地渗透也是可以的,比如,通过无线进入目标内部<br>&nbsp;&nbsp;&nbsp;&nbsp;这也算是一种相对比较高效的渗透方式,老外非常干这个,但前提是,你可能需要很多次的蹲点,才能确认目标,实地渗透对你的心里素质要求可能会更高一些,另外,现场的环境和有限的时间也多多少少会影响到你<br><br></p>
<p>一些小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;时间原因,暂时就想到这些,都是一些平时的经验加上一点自己的想法,其实,就整个信息搜集来讲,对你的社工能力其实是个不小的考验,我自己在这方面确实是弱项,后续会慢慢加强<br><br></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/dirscan-tools/">dirscan tools</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/18/info-getshell/">信息搜集阶段可快速Getshell的一些方式</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-18
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">针对各类开源程序的一些老exp</span><br><span class="line">各远程执行类漏洞,如,Struts2,iis,tomcat,proftp,elasticsearch...</span><br><span class="line">各种敏感文件下载泄露,如,各类备份下载,敏感配置文件泄露,后端脚本源码泄露,svn泄露...</span><br><span class="line">针对各类服务的未授权访问</span><br><span class="line">各类web及服务入口弱口令,万能密码...</span><br><span class="line">各类后门,如,别人的webshell,古老的shift后门,等等……</span><br><span class="line">bash远程执行,心脏滴血...</span><br><span class="line">win smb系列远程执行漏洞,如,ms17-<span class="number">010</span></span><br><span class="line">目标的各类vpn及mail账号密码泄露</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p><br></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/info-getshell/">info getshell</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/17/dirscan-tools/">熟练使用各类敏感目录文件扫描工具</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-17
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 wwwscan 实际测试速度还可以,编码 [应该是cmd默认的编码问题<code>gbk</code>] 貌似还有些问题,另外,程序写的有些过于死板,异常处理不太到位,误报稍微有些严重:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-p 	指定目标web端口,因为有些web服务并非工作在默认的80或者8080上,需要手工指定目标的web服务端口</span><br><span class="line">-m 	指定扫描使用的最大线程,不要太大,实际中15到20就差不多了</span><br><span class="line">-t 	指定请求的超时时间</span><br><span class="line">--ssl 	扫描https站点时记得加上此选项</span><br><span class="line">-r 	指定网站根目录,有些站点程序是放在web目录下的一个子目录中的,这时就需要你自己手工指定目标网站根目录</span><br></pre></td></tr></table></figure></p>
    <!-- Only display the Read More link if we are displaying an excerpt -->
    
        <p id="readmore">
            <a href="/2014/12/17/dirscan-tools/">
                Read More >>>
            </a>
        </p>
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/dirscan-tools/">dirscan tools</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/16/dirscan/">快速搜集目标的各类Web管理入口,敏感目录,文件及错误配置</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-16
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 下面是自己找网站后台的一些常规办法[注意,对于找后台主要都是针对一些非开源web程序,如果是开源程序,直接把代码down下来看下目录结构,不就什么都有了,何苦找呢]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">首先,看看目标站自己的前端页面上,有没有给我们提供后台入口,很多脑残的政府和学校站很可能都会这么干,直接把后台入口丢在前端页面上,你方便,别人也方便</span><br><span class="line">尝试访问目标的robots.txt文件,如果有的话,看看里面有没有后台或者上传点之类的敏感目录,至于robots.txt文件本身的作用,大家请自行谷歌,这里就不多做解释了</span><br><span class="line">习惯性的盲打一些常见的后台目录名,如<span class="symbol">:/admin/</span>,<span class="regexp">/manage/</span>,<span class="regexp">/cms/</span>,<span class="regexp">/system/</span>,<span class="regexp">/administrator/</span>,<span class="regexp">/wp-login.php,/control</span><span class="regexp">/等,记得大小写变换下多试几个……</span></span><br><span class="line"><span class="regexp">使用各类基于字典的目录爆破及爬行工具,如:dirb,wwwscan,cansina,uniscan,破壳以及其它的各种py脚本,非常多,现在也有很多在线的目录爆破工具站,这类的工具其实并没什么太多的技术含量,实际效果还得取决于你的字典质量和目标的防护程度,抛开防护先不说,起码网站敏感目录文件字典要好好花点儿时间精心准备</span></span><br><span class="line"><span class="regexp">"cscan"谷歌浏览器小插件,速度快,误报极高,具体原理,本人暂时还没弄明白,不过可以尝试下,自己用的比较少,记得有一次实在没办法就就抱着侥幸试了一下,结果真就跑出来了,可能是运气吧</span></span><br><span class="line"><span class="regexp">对于大型站点,可利用之前提到的google hacking,这里就不细说了,请仔细看前面的说明</span></span><br><span class="line"><span class="regexp">用各种wvs爬,也许也能爬出来一些,关于这类web漏洞扫描器的具体使用,后面会有详细说明,这里就先不细说了,例如: awvs,appscan,netsparker……</span></span><br><span class="line"><span class="regexp">如果是windows的话,不妨尝试下短文件漏洞扫描工具,鸡肋的是,它只能扫出前6个字节(6个英文字符),也就是说你只能看一部分猜一部分,好处在于前6个字节起码是绝对正确的</span></span><br><span class="line"><span class="regexp">配合网站的域名或者业务社工,比如:商城站一般我们会想到什么呢,shop?,有的后台目录也可能是依据目标域名的各种变形,多尝试……</span></span><br><span class="line"><span class="regexp">尝试各种万能密码,虽然很low,但很直接,存在万能密码问题的程序毕竟也不在少数,如:phpmyadmin 2.11.3-2.11.4 等……</span></span><br><span class="line"><span class="regexp">如果实在找不到,就想想办法直接问管理员吧,至于套不套的出来,就要看你自己的本事了,嘿嘿……</span></span><br></pre></td></tr></table></figure></p>
<p>0x02 除了一些常规网站后台入口,我们也可以尝试各种java web入口,尤其是针对各种java控制台的,当然,前提是目标要有,基本进去后,shell权限都非常大:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tomcat[默认端口<span class="number">8080</span> 需要用户名密码,还是那句话多尝试些弱口令,进去以后上传war马]</span><br><span class="line">jboss [默认端口<span class="number">8080</span>无需任何验证,进去以后上传war马]</span><br><span class="line">weblogic [默认端口<span class="number">7001</span>,实际很多是在<span class="number">8080</span>上,进去以后上传war马]</span><br><span class="line">Websphere[默认端口<span class="number">9043</span>,实际很多是在<span class="number">8080</span>上,进去以后上传war马]</span><br><span class="line">webmin[web版的服务器管理工具,默认端口<span class="number">10000</span>,可以把它当做图形版的ssh管理工具]</span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p>0x03 查找其它的各类敏感文件目录,自己所说的敏感文件及目录一般包括如下内容:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">网站源码备份文件,数据库备份文件,配置文件备份等...一般命名都是类似wwwroot.zip,wwwroot.sql这种的,建议直接用专门的备份的字典跑</span><br><span class="line">目标服务器的各种探针类文件,例如<span class="symbol">:phpinfo</span>.php,test.asp,info.aspx……</span><br><span class="line">目标网站的物理路径,注意物理路径和网站路径的区别,网站路径都是以www为根目录,而物理路径则是指系统某个分区下的绝对路径,如<span class="symbol">:c</span><span class="symbol">:</span>\windows\system32  /usr/local/lib</span><br><span class="line">网站后台目录,上传目录,如: 各类上传点,各类漏洞编辑器中的敏感路径</span><br><span class="line">网站数据库连接配置类文件</span><br><span class="line">各类数据库的web管理入口,例如<span class="symbol">:phpmyadmin</span>,adminer……之流</span><br><span class="line">目标网站后台脚本源码泄露及各种各样的网站报错信息</span><br><span class="line">svn 文件泄露如,.svn,用户命令历史文件泄露,如,.history...</span><br><span class="line">其它各种第三方服务的核心配置文件,里面可能会有用户密码……例如<span class="symbol">:cisco</span> vpn,ser-u……</span><br><span class="line">目标内部的各种账号密码信息,并不仅限于邮箱,vpn,ftp……</span><br><span class="line">web服务器配置错误所导致的目录遍历</span><br><span class="line">别人的webshell,目录扫描工具对这个的扫描似乎不太靠谱,因为有些shell隐藏的比较深,所以还是建议直接用google爬各种webshell特征</span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p>0x04 另外,还有一些目标内部的OA系统入口,不过这些通常都不在常规的web端口上,又该怎么办呢,其实,很多情况下,你可以习惯性的尝试访问以下目标的81,82,83,86,88,8081,8082,8088这样的web端口,说不定就会有惊喜:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在目标防火墙没有开启的情况下,可以用一些之前介绍过的公网端口扫描工具,进行全端口扫描,然后根据扫到的结果,看着可能是web端口的,再尝试在浏览器中逐个访问</span><br><span class="line">如果目标开起了防火墙[waf],除了谷歌,或者直接在目标网站上找找,基本也就没谁了,扫可能是不太现实的,嘿嘿……如果大家有更好的思路也期待能一起交流</span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p>0x05 搜集目标的各种元数据,如果能搜集到一些有用的账号密码,自然是最好不过了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foca 工具除了挖掘各种元数据之外,包括目标子域识别,服务器错误配置,web高危扫描……功能还是非常好用的,尤其是针对大中型站点,效果相对比较明显</span><br></pre></td></tr></table></figure></p>
<p><br><br>小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;对于后台查找自己知道的基本也就这么多了,如果实在找不到,不妨换换别的思路,web只是我们渗透过程中的其中一个入手点,却不是唯一的入手点,别太死板就行,更多手法,也期待能和大家一起交流学习</p>
<p><br></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/dirscan/">dirscan</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/15/shodan-hacking/">熟练利用 Shodan Hacking 辅助我们快速渗透[ 大中型目标 ]</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-15
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 shodan 是什么 :<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">同样是搜索引擎,但它并不像谷歌,bing...那样,只单单针对web 中的各类html数据进行爬取</span><br><span class="line">shodan 是基于各类在线网络设备的旗标的全网搜索</span><br><span class="line">如,各类边界网络摄像头,路由器,交换机... ,中间件服务[如,各类web服务器,数据库,分布式中间件,文件共享服务等...]</span><br><span class="line">默认只能看到一部分搜索结果,具体是多少条已经忘记了</span><br><span class="line">可能需要付点费才能看到更多的搜索结果,同样它也提供查询api,这就非常方便按照我们自己的扫描需求定制脚本</span><br><span class="line">在渗透一些特定的网络设备或者自己手握0day批量打的时候还是非常好使的,俗称<span class="string">"工控设备渗透"</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>0x02 那,我们到底可以用它来干些什么呢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">利用0day实施大规模批量入侵,前提是不要把自己的0day撞到别人的蜜罐里面去了,否则就可惜了</span><br><span class="line">全网批量统计所有感染有某一数据特征的后门,可以专门用来检测某种定向攻击</span><br><span class="line">批量扫描各种中间件的高危错误配置及能被远程利用的各类已知漏洞,也就是说完全可以把它当成一个高级的漏洞扫描器来用</span><br><span class="line">批量探测各种弱口令</span><br><span class="line">批量抓各种shell [ 不仅限于webshell,backdoor ... ]等……</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>0x03 关于shodan本身的更多详情,请直接参考其官方站点 [注册个账号是必须的]:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.shodan.io/</span><br></pre></td></tr></table></figure></p>
<p>0x04 跟google hacking一样,shodan也有一套属于自己的语法规则,下面是shodan         内置的几个简单过滤器:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">city:</span>   	城市,貌似只支持英文,而且不是能是简称,如,TOKYO,Hong Kong,Seoul...</span><br><span class="line"><span class="symbol">country:</span>  	指定国家或地区后缀,比如<span class="symbol">:cn</span>,us,jp,tw,br,ph,vn,hk...</span><br><span class="line"><span class="symbol">hostname:</span> 	指定主机名,其实就是目标域名[域名如果是子域还需要在前面加个.]</span><br><span class="line"><span class="symbol">net:</span>      	指定网络范围,可以是单个ip或者cidr格式的ip段</span><br><span class="line">os :   		指定操作系统 centOS,win32,red hat,suse 等...</span><br><span class="line"><span class="symbol">port:</span>  		指定端口,HTTP (<span class="number">80</span>),FTP (<span class="number">21</span>),SSH (<span class="number">22</span>),SNMP (<span class="number">161</span>),SIP (<span class="number">5060</span>)等...</span><br><span class="line"><span class="symbol">product:</span>  	指定具体的产品名称,如,各类web服务器,数据库服务器,网络设备名称等...</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>0x05 下面是一些简单的搜索实例:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">搜集某个城市的特定设备 [这里暂以不同类型的web服务器为例] 标识 [自己可以事先多收集一些常见的软件和设备标识]<span class="symbol">:</span></span><br><span class="line">Microsoft-IIS/<span class="number">5.0</span> <span class="symbol">city:</span><span class="string">"TOKYO"</span>   可逐个尝试能否直接写shell</span><br><span class="line">Microsoft-IIS/<span class="number">6.0</span> <span class="symbol">city:</span><span class="string">"Seoul"</span>	 可逐个尝试能否直接 RCE</span><br><span class="line">Microsoft-IIS/<span class="number">7.5</span> <span class="symbol">city:</span><span class="string">"Hong Kong"</span> </span><br><span class="line">apache <span class="symbol">city:</span><span class="string">"Nagoya"</span> </span><br><span class="line">Apache/<span class="number">2.2</span>.<span class="number">27</span> <span class="symbol">city:</span><span class="string">"Nagoya"</span></span><br><span class="line">Tomcat <span class="symbol">city:</span><span class="string">"Seoul"</span>	可逐个尝试能否直接 RCE</span><br><span class="line">cisco <span class="symbol">city:</span><span class="string">"Osaka"</span></span><br><span class="line">tplink <span class="symbol">city:</span><span class="string">"nanjing"</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/shodan webserver.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">搜索特定版本的操作系统及端口<span class="symbol">:</span></span><br><span class="line"><span class="symbol">os:</span><span class="string">"linux"</span> <span class="symbol">net:</span><span class="string">"72.34.62.0/24"</span></span><br><span class="line"><span class="symbol">os:</span><span class="string">"windows"</span> <span class="symbol">net:</span><span class="string">"195.40.91.0/24"</span></span><br><span class="line">Apache <span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"8080"</span>  <span class="symbol">product:</span><span class="string">"Apache Tomcat/Coyote JSP engine"</span></span><br><span class="line">Apache <span class="symbol">city:</span><span class="string">"Seoul"</span> <span class="symbol">port:</span><span class="string">"8080"</span></span><br><span class="line"><span class="symbol">hostname:</span><span class="string">".polyu.edu.hk"</span> <span class="symbol">os:</span><span class="string">"windows"</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/shodan apache.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">搜索指定国家地域特定类型的工具服务 (还是那句话,多搜集一些高质量的工具banner)<span class="symbol">:</span></span><br><span class="line"><span class="symbol">product:</span><span class="string">"tomcat"</span>  <span class="symbol">net:</span><span class="string">"158.132.18.0/24"</span></span><br><span class="line"><span class="symbol">product:</span><span class="string">"apache"</span>  <span class="symbol">net:</span><span class="string">"158.132.18.0/24"</span></span><br><span class="line"><span class="symbol">product:</span><span class="string">"iis"</span>     <span class="symbol">net:</span><span class="string">"158.132.18.0/24"</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"8080"</span> jboss <span class="symbol">country:</span>CN</span><br><span class="line"><span class="symbol">port:</span><span class="string">"8080"</span> jboss <span class="symbol">country:</span>IN</span><br></pre></td></tr></table></figure>
<p><img src="/img/shodan webserver iis.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">扫描指定网段内的所有特定数据库服务器<span class="symbol">:</span></span><br><span class="line"><span class="symbol">product:</span><span class="string">"Mysql"</span>  <span class="symbol">net:</span><span class="string">"140.117.13.0/24"</span> <span class="symbol">port:</span><span class="string">"3306"</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"1433"</span> <span class="symbol">net:</span><span class="string">"78.131.197.0/24"</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"5432"</span> <span class="symbol">net:</span><span class="string">"77.55.149.0/24"</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"1521"</span> <span class="symbol">net:</span><span class="string">"78.143.192.0/12"</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"1521"</span> <span class="symbol">city:</span><span class="string">"Osaka"</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/shodan webserver mssql.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">搜索特定远程管理终端端口<span class="symbol">:</span></span><br><span class="line"><span class="symbol">os:</span><span class="string">"windows"</span> <span class="symbol">port:</span><span class="string">"3389"</span> <span class="symbol">net:</span><span class="string">"107.160.1.0/24"</span></span><br><span class="line"><span class="symbol">os:</span><span class="string">"linux"</span> <span class="symbol">port:</span><span class="string">"22"</span> <span class="symbol">net:</span><span class="string">"107.160.1.0/24"</span></span><br><span class="line"><span class="symbol">os:</span><span class="string">"linux"</span> <span class="symbol">port:</span><span class="string">"23"</span> <span class="symbol">net:</span><span class="string">"107.160.1.0/24"</span></span><br><span class="line"><span class="symbol">os:</span><span class="string">"linux"</span> <span class="symbol">port:</span><span class="string">"23"</span> <span class="symbol">net:</span><span class="string">"87.124.0.0/15"</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/shodan webserver 3389.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">搜各类路由的特定web管理端口<span class="symbol">:</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">搜索ftp / tftp <span class="symbol">:</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"21"</span> <span class="symbol">net:</span><span class="string">"107.160.1.0/24"</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"69"</span> <span class="symbol">net:</span><span class="string">"218.242.16.0/24"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在某个城市中搜索指定的端口,操作系统及在线网络设备<span class="symbol">:</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"69"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"3389"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"22"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"23"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"3306"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"110"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">os:</span><span class="string">"windows"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">product:</span><span class="string">"cisco"</span></span><br><span class="line"><span class="symbol">city:</span><span class="string">"Hong Kong"</span> <span class="symbol">port:</span><span class="string">"8080"</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/shodan webserver hong kong 3389.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">搜索指定国家的特定设备,端口,服务器<span class="symbol">:</span></span><br><span class="line"><span class="symbol">port:</span><span class="string">"23"</span> <span class="symbol">country:</span>CN</span><br><span class="line"><span class="symbol">port:</span><span class="string">"1433"</span> <span class="symbol">country:</span>CN</span><br><span class="line"><span class="symbol">port:</span><span class="string">"3389"</span> <span class="symbol">country:</span>CN</span><br><span class="line">tplink <span class="symbol">country:</span>CN</span><br><span class="line">huawei <span class="symbol">country:</span>CN</span><br><span class="line">netcam  <span class="symbol">country:</span>CN</span><br><span class="line"><span class="symbol">country:</span>CN <span class="symbol">net:</span><span class="string">"115.225.113.0/24"</span> <span class="symbol">port:</span><span class="string">"22"</span></span><br><span class="line"><span class="symbol">country:</span>CN router</span><br><span class="line">admin login  <span class="symbol">country:</span>HK</span><br><span class="line">hacked by <span class="symbol">country:</span>HK</span><br></pre></td></tr></table></figure>
<p><img src="/img/shodan webserver netcam.png" alt=""><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">搜缺省密码<span class="symbol">:</span></span><br><span class="line"><span class="string">"default password"</span> <span class="symbol">city:</span><span class="string">"Hong Kong"</span></span><br><span class="line"><span class="symbol">country:</span>CN <span class="string">"default password"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">搜exp[其实,就是把exploit上的东西扒下来]<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/exploits.shodan.io/welcome</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">搜索各类漏洞摄像头<span class="symbol">:</span></span><br><span class="line">netcam <span class="symbol">net:</span><span class="string">"187.189.82.0/24"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">批量搜集一些开源web程序,尝试0day批量利用<span class="symbol">:</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">针对某个端口,批量搜集感染了某种数据标志的木马<span class="symbol">:</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">批量搜集一些经典漏洞尝试利用,比如<span class="symbol">:iis</span>,tomcat,jboss... RCE,心脏滴血,bash远程执行,等等……<span class="symbol">:</span></span><br></pre></td></tr></table></figure>
<p>0x06 下面是一些常见的默认用户名密码,可以尝试撞撞运气:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">ACTi:</span> admin/<span class="number">123456</span> <span class="keyword">or</span> Admin/<span class="number">123456</span></span><br><span class="line">Axis (traditional): root/pass,</span><br><span class="line">Axis (new): requires password creation during first login</span><br><span class="line"><span class="symbol">Cisco:</span> No default password, requires creation during first login</span><br><span class="line"><span class="symbol">Grandstream:</span> admin/admin</span><br><span class="line"><span class="symbol">IQinVision:</span> root/system</span><br><span class="line"><span class="symbol">Mobotix:</span> admin/meinsm</span><br><span class="line"><span class="symbol">Panasonic:</span> admin/<span class="number">12345</span></span><br><span class="line">Samsung <span class="symbol">Electronics:</span> root/root <span class="keyword">or</span> admin/<span class="number">4321</span></span><br><span class="line">Samsung Techwin (old): admin/<span class="number">1111111</span></span><br><span class="line">Samsung Techwin (new): admin/<span class="number">4321</span></span><br><span class="line"><span class="symbol">Sony:</span> admin/admin</span><br><span class="line"><span class="symbol">TRENDnet:</span> admin/admin</span><br><span class="line"><span class="symbol">Toshiba:</span> root/ikwd</span><br><span class="line"><span class="symbol">Vivotek:</span> root/&lt;blank&gt;</span><br><span class="line"><span class="symbol">WebcamXP:</span> admin/ &lt;blank&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">关于shodan 的入门用法到这里基本就差不多了,建议大家如果真的想用好,可以付点费自己写脚本,当然,你也可以直接用别人提供好的py shodan库</span><br><span class="line">国内利用此api衍生出来的工具还是蛮多的,这里就不一一细说了</span><br><span class="line">总之来讲,批量抓shell效果还是非常不错的</span><br><span class="line">从上面我们也不难发现,利用的核心还是各种特征 [banner] 质量加上你自己的想象力,因为它直接决定了你的命中率</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>0x07 另外,再介绍两个国内的小工具站,使用非常简单,纯图形化的,这里就不细说了:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/www.punkspider.org/</span>   在线web漏洞扫描</span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/ics.zoomeye.org/</span>       基于shodan实现</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>0x08 最后再提下bing(目前已经费掉了,很多人的C段旁站工具想必都是基于此api写的),下面是常见使用方法:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">ip:</span>ip地址    它就会把这个ip所对应的所有域名都列出来</span><br></pre></td></tr></table></figure></p>
<p>0x09 基于此api的各种C段旁站工具编写原理:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">编写过程其实也很简单,就是把bing搜索的结果格式化截取输出一下</span><br><span class="line">不过,在此之前你需要事先去bing申请一下搜索用的api</span><br><span class="line">去微软的开发者中心申请一个即可</span><br><span class="line">如果旁站能想通,那么C段也只不过是把<span class="number">254</span>台机器在线的ip又轮训一遍而已,我想你应该懂了</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<p>0x10 一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;关于google和shodan的用法,大概就介绍到这里了,使用都比较简单,基本就是几个过滤器来回的组装,随意的根据自己的实际需求拼装特征,说道底,还是看大家的想象力和对现有信息特征的敏感度,大家也看到了,如果完全手工的话,确实挺累的,为什么不写成自动化的脚本来帮我们完成呢,当然,这类的工具也有很多现成的,不过并不是按照咱们的想法来的,所以,最好自己动手……不过在写脚本之前,自己首先要能熟练使用才是,这样写出来的工具杀伤力才能更大些,当然,关于这类web搜索引擎所能产生的渗透效果的强弱,主要是还是看搜索引擎对目标收录的多少,如果目标站点建立的时间比较长,而且各大搜索引擎的收录量也比较好的话,这时候你利用谷歌固然成效显著,但如果一个站点刚建立不久,谷歌收录量也非常少,这时谷歌对你来讲也许就只是个摆设,这里说到的内容可能还只是各个搜索引擎利用的冰山一角,更多更强大的功能,还要靠大家一起来慢慢挖掘,对了,最后再说明一点,用这些搜索引擎的时候,最好全程挂上vpn,推荐美国的,原因大家应该都明白,自家人对自家人的限制几乎是最少的,不要问我为什么不介绍百度没办法,太不堪(原因大家都懂……)</p>
<p><br><br>0x10 一点心得:<br>&nbsp;&nbsp;&nbsp;&nbsp;一般我们在搜索引擎上搜集目标信息的时候,首先,应该直奔一些比较高危的漏洞特征,比如能快速getshell的,比如,默认账号密码,进去以后就只可以直接传shell的,此外,如果目标有支持jsp脚本的机器,我们首先就应该从jsp开始入手,因为jsp程序的权限一般都非常高,几乎是服务器的管理员权限,所以我们平时在搜集信息过程中,也尽量先找一些最好能直取权限的信息,孰轻孰重,自己心里一定要有分寸,这样可以避免我们做太多的无用功,当然,如果你手上有个开源的web程序未公开的0day,然后配合类似的搜索引擎利用,那结果可想而知,反正我们利用各种搜索引擎的最终目的无非就是想尽快找个目标边界先进去……<br><br></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/shodan-hacking/">shodan hacking</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/14/search-hacking/">熟练利用Google Hacking来辅助我们快速渗透</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-14
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 google hacking 几个基础过滤器用途简介[说在前面的话,过滤器是死的人是活的,实际用的时候把脑洞放开,尽你所能拼装,才有可能达到超预期效果]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intitle:</span>     从网页标题中搜索指定的关键字,可专门用来搜索指定版本名称的各类web程序,也可用allintitle</span><br><span class="line"><span class="symbol">inurl:</span> 	     从url中搜索指定的关键字,可专门用来构造各种形式的漏洞url,也可用allinurl</span><br><span class="line"><span class="symbol">intext:</span>      从网页中搜索指定的关键字,经常会用它来穿透到漏洞页面……也可用allintext</span><br><span class="line"><span class="symbol">filetype:</span>    搜索指定的文件后缀,例如<span class="symbol">:sql</span> mdb txt bak backup ini zip rar doc xls…… </span><br><span class="line"><span class="symbol">site:</span>        在某个特定的网站内中搜索指定的内容</span><br><span class="line"><span class="symbol">link:</span>        搜索和该链接有关联的链接,比如<span class="symbol">:</span>友情链接</span><br><span class="line">index <span class="symbol">of:</span>    找目录遍历时也许会用到</span><br></pre></td></tr></table></figure></p>
<p>0x02 google hacking所支持的一些通配符(建议选择性的用,因为越精确,也意味着能搜到的结果越少,这样容易漏掉一些有价值的目标,我们最终目的还是希望能尽快找到有漏洞的站先进去再说):<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+   强制包含某个字符进行查询</span><br><span class="line">-   查询的时候忽略某个字符</span><br><span class="line"><span class="string">""</span>  查询的时候精确匹配双引号内的字符</span><br><span class="line">.   匹配某单个字符进行查询</span><br><span class="line">*   匹配任意字符进行查询</span><br><span class="line"><span class="params">|   或者,多个选择,只要有一个关键字匹配上即可</span></span><br></pre></td></tr></table></figure></p>
<p>0x03 找各种web入口,当然,这里所指的web入口并非仅限于各种常规网站后台[说到网站后台,一定要手工多尝试几个路径,实在猜不到,再用字典跑,节省时间]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如一些疑似目标内网的各种web管理系统入口,web端的数据库管理入口,某些设备的web端配置入口,以及一些常见的java控制台入口等等...</span><br><span class="line">反正只要你觉得进去以后能上传脚本的地方全部都可以尝试,东西在你手里,可劲儿用就是了</span><br></pre></td></tr></table></figure></p>
<p>搜集各版本tomcat入口[默认在8080端口上]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat 		直接这样搜结果肯定会非常多</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">inurl:</span><span class="number">8080</span>/    			我们可以带指定端口号去搜,因为有些web并非在默认端口上,这样搜的话,可以尽量防止有漏网之鱼</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>Apache Tomcat/<span class="number">5.5</span>.<span class="number">27</span> <span class="symbol">site:</span>*.hk      针对特定版本特定国家去搜,比如爆出某个版本有远程执行类的漏洞就可以利用这种方式来批量进行</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>Apache Tomcat/<span class="number">7.0</span>.<span class="number">32</span> <span class="symbol">site:</span>*.gov.br</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>Apache Tomcat/<span class="number">5.0</span>.<span class="number">12</span> <span class="symbol">site:</span>*.cn</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>Apache Tomcat/<span class="number">6.0</span>.<span class="number">24</span> <span class="symbol">site:</span>*.com</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>*.edu.*</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>*.gov.*		搜特定类型的目标站点,如,学校一般都是edu,各种民间组织一般都是org,政府机构一般都是gov……</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>*.org.*</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>Apache Tomcat/<span class="number">7.0</span> <span class="symbol">site:</span>*.org.*</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>*.jp</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>*.vn</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>*.ph</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>Apache Tomcat <span class="symbol">site:</span>*.uk</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>baidu.com	无意发现百度的某个子域,竟然是个博彩站</span><br><span class="line"><span class="symbol">intext:</span>$CATALINA_HOME/webapps/ROOT/ <span class="symbol">intitle:</span>apache tomcat <span class="symbol">site:</span>org.tw</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google tomcat.png" alt=""><br></p>
<p>搜集weblogic入口:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/console/login/LoginForm.jsp  	这样范围太大,可根据上面的示例随意变形</span><br><span class="line"><span class="symbol">inurl:</span>/console/login/LoginForm.jsp <span class="symbol">intitle:</span>Oracle WebLogic Server</span><br><span class="line"><span class="symbol">inurl:</span>/console/login/ <span class="symbol">intitle:</span><span class="string">"Oracle WebLogic Server 管理控制台"</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google weblogic.png" alt=""><br></p>
<p>搜集jboss入口:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/jmx-console/htmladaptor</span><br><span class="line"><span class="symbol">inurl:</span>/jmx-console/htmladaptor <span class="symbol">site:</span>*.edu.*</span><br><span class="line"><span class="symbol">inurl:</span>/jmx-console/htmladaptor <span class="symbol">site:</span>*.org.*</span><br><span class="line"><span class="symbol">inurl:</span>/jmx-console/htmladaptor <span class="symbol">site:</span>*.tw</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google jboss.png" alt=""><br></p>
<p>搜集websphere入口:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/ibm/console/logon.jsp</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google websphere.png" alt=""><br></p>
<p>搜集phpmyadmin入口:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/phpMyAdmin/index.php </span><br><span class="line"><span class="symbol">inurl:</span>/phpMyAdmin/index.php db+information_schema   	指定命中数据</span><br><span class="line"><span class="symbol">inurl:</span>/phpMyAdmin/index.php <span class="symbol">intext:</span>phpMyAdmin <span class="number">2.7</span>.<span class="number">0</span> 	直接针对特定版本号去搜索,更加精准</span><br><span class="line"><span class="symbol">inurl:</span>/phpMyAdmin/index.php <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/phpMyAdmin/index.php <span class="symbol">site:</span>*.org</span><br><span class="line"><span class="symbol">inurl:</span>/phpMyAdmin/index.php <span class="symbol">site:</span>*.hk</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google phpmyadmin.png" alt=""><br></p>
<p>批量搜集webmin入口[其实就是一个web版的linux系统管理工具,默认情况下工作在web端的10000端口上]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intitle:</span>Login to Webmin <span class="symbol">intext:</span><span class="string">"login to the Webmin server on"</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google webmin.png" alt=""><br></p>
<p>批量搜wordpress程序[关于wp的特征比较多,大家可自行构造]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/wp-login.php  <span class="symbol">site:</span>*.hk</span><br><span class="line">index of /wp-content/uploads <span class="symbol">inurl:</span>/wp-login.php</span><br><span class="line"><span class="symbol">inurl:</span>/wp-content/themes/theagency    上传漏洞</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google wp.png" alt=""><br></p>
<p>批量搜joomla程序:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/administrator/index.php</span><br><span class="line"><span class="symbol">inurl:</span>index.php?option=com_advertisementboard  找注入</span><br><span class="line"><span class="symbol">inurl:</span>index.php?option=com_carocci</span><br><span class="line"><span class="symbol">inurl:</span>index.php?option=com_product</span><br><span class="line"><span class="symbol">inurl:</span>/administrator/index.php <span class="symbol">site:</span>*.hk</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google joomla.png" alt=""><br></p>
<p>批量搜drupal程序:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>CHANGELOG.txt <span class="symbol">intext:</span>drupal <span class="symbol">intext:</span><span class="string">"SA-CORE"</span> -<span class="symbol">site:</span>github.com -<span class="symbol">site:</span>drupal.org</span><br></pre></td></tr></table></figure></p>
<p>批量搜discuz程序:</p>
<p>批量搜集opencart程序:</p>
<p>批量搜集phpbb程序:</p>
<p>更多…</p>
<p>当然,你也可以根据下面的一些特征去找特定的开源程序[这种命中率显然没有直接用特征目录的命中率高]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">power by wordpress                powered by discuz x3.<span class="number">2</span></span><br><span class="line">powered by phpcms <span class="number">2008</span>            powered by drupal <span class="number">7</span></span><br><span class="line">powered by dedecmsv57_gbk         powered by CubeCart <span class="number">3.0</span>.<span class="number">6</span></span><br><span class="line">Powered by phpBB <span class="number">2.0</span>.<span class="number">6</span>            powered by paBugs <span class="number">2.0</span> Beta <span class="number">3</span></span><br><span class="line"><span class="symbol">inurl:</span>wp-login.php                <span class="symbol">inurl:</span>/administrator/index.php    </span><br><span class="line"><span class="symbol">inurl:</span>/admina.php</span><br></pre></td></tr></table></figure></p>
<p>批量搜集目标是否用了一些存在漏洞的邮件程序[不一定有,多尝试,反正是搜集,找到东西价值越高越好]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">owa:</span></span><br><span class="line"><span class="symbol">inurl:</span>/owa/auth/logon.aspx </span><br><span class="line"><span class="symbol">inurl:</span>/owa/auth/logon.aspx <span class="symbol">site:</span>*.org.*</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mirapoint(ShellShock)<span class="symbol">:</span></span><br><span class="line"><span class="symbol">inurl:</span>/cgi-bin/search.cgi <span class="symbol">site:</span>*.org.*</span><br><span class="line"><span class="symbol">inurl:</span>/cgi-bin/madmin.cgi</span><br></pre></td></tr></table></figure>
<p><img src="/img/google mirapoint.png" alt=""><br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Zimbra(本地包含):</span><br><span class="line">inurl:7071/zimbraAdmin/</span><br><span class="line">inurl:/help/en_US/standard/version.htm</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Atmail(用于连接数据库的配置文件泄露)<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line">TurboMail(配置错误,进入任意邮箱)<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line">U-mail(注入&amp;getshell)<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line">Lotus Domino Webmail(越权访问)<span class="symbol">:</span></span><br></pre></td></tr></table></figure>
<p>批量找常规网站后台[下面的php也可以换成asp,aspx,jsp 多次尝试,因为每个国家对后台的命名习惯各有特色,所以,这里只列举了一些相对命中率比较高的,找到后台以后,记得习惯性多尝试几个弱口令,万能密码未授权之类的东西]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/manager/login.php <span class="symbol">site:</span>*.jp</span><br><span class="line"><span class="symbol">inurl:</span>/cms/login.php <span class="symbol">site:</span>*.jp</span><br><span class="line"><span class="symbol">inurl:</span>/manage/index.php <span class="symbol">site:</span>*.jp</span><br><span class="line"><span class="symbol">inurl:</span>/system/login.php <span class="symbol">site:</span>*.jp</span><br><span class="line"><span class="symbol">inurl:</span>/webadmin/login.php <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>admin_login.php <span class="symbol">intitle:</span>admin login</span><br><span class="line"><span class="symbol">inurl:</span>admin_login.php <span class="symbol">intitle:</span>admin page</span><br><span class="line"><span class="symbol">inurl:</span>/admin/login.php <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/admin/index.php <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/system/adminlogin.asp  <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/manage/login.aspx  <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/sysadm/index.php  <span class="symbol">site:</span>*.com</span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google manager.png" alt=""><br></p>
<p>找svn泄露[运气好说不定能脱到密码]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/.svn/entries </span><br><span class="line"><span class="symbol">inurl:</span>/.svn/entries <span class="symbol">site:</span>*.org.*</span><br><span class="line"><span class="symbol">inurl:</span>/.svn/entries <span class="symbol">site:</span>*.gov.br</span><br><span class="line"><span class="symbol">inurl:</span>/.svn/entries <span class="symbol">site:</span>*.hk</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google svn.png" alt=""><br></p>
<p>批量找目标的后台未授权访问:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">"Website Design &amp; Developed By : WebSay"</span>  默认后台/admin</span><br><span class="line"><span class="symbol">intext:</span><span class="string">"Powered by ENS Consultants"</span>  默认后台/admin/login.php</span><br><span class="line"><span class="symbol">intext:</span><span class="string">"Desenvolvimento - MW Way"</span>    默认后台/admin/index.php</span><br><span class="line"><span class="symbol">inurl:</span>.php?id= <span class="symbol">intext:</span><span class="string">"Web realizada por Soma Estudio"</span> </span><br><span class="line"><span class="symbol">inurl:</span>/_mycps/login.php</span><br></pre></td></tr></table></figure></p>
<p>批量找弱口令:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">"design by weli"</span>   默认后台: <span class="regexp">/adm/login</span>.php 除了弱口令还有注入</span><br><span class="line">username : linjizen@gmail.com</span><br><span class="line">password : lin719192</span><br></pre></td></tr></table></figure></p>
<p>尽可能多的找到能够利用的各种上传点[比如:各种典型的漏洞编辑器地址,ck,kindeditor,fck,ewebeditor……]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">" Powered by JADBM "</span>   JADBM Cms upload shell 注册后登陆上传即可</span><br><span class="line"><span class="symbol">inurl:</span><span class="string">"/index.php/frontend/login/en"</span>  Estate cms upload shell 注册后登陆上传即可</span><br><span class="line"><span class="symbol">inurl:</span>/Content/Roxy_Fileman/   该路径下直接就是上传点</span><br><span class="line">index <span class="symbol">of:</span><span class="string">"filemanager/dialog.php"</span>  该脚本就是上传脚本直接上传即可</span><br><span class="line"><span class="symbol">intext:</span><span class="string">"Desenvolvido por Webnet Soluções Tecnológicas."</span> fck上传</span><br><span class="line"><span class="symbol">inurl:</span><span class="string">"subir_foto.php"</span> 上传点</span><br><span class="line"><span class="symbol">inrul:</span><span class="string">"/imce?dir="</span> <span class="symbol">intitle:</span><span class="string">"File Browser"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">"Powered by Vision Helpdesk 3.9.10 Stable"</span> 注册后登陆进去编辑个人配置上传</span><br><span class="line">index of /admin/fckeditor <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/ewebeditor/  <span class="symbol">site:</span>*.tw</span><br><span class="line"><span class="symbol">inurl:</span>/admin/upload_file.php</span><br><span class="line"><span class="symbol">inurl:</span>/admin/upfile.php </span><br><span class="line"><span class="symbol">inurl:</span>/admin/upload.asp</span><br></pre></td></tr></table></figure></p>
<p>找到可能存在包含和命令执行类的漏洞的一些典型参数:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>footer.inc.php?settings=</span><br><span class="line"><span class="symbol">inurl:</span>/pb_inc/admincenter/index.php?page=</span><br><span class="line"><span class="symbol">inurl:</span>/pnadmin/categories.inc.php?subpage=</span><br><span class="line"><span class="symbol">inurl:</span>/index.php??view=src/sistema/vistas/</span><br><span class="line"><span class="symbol">inurl:</span>/edit.php?em=file&amp;filename=</span><br><span class="line"><span class="symbol">inurl:</span>/path_to_athena/athena.php?athena_dir= 远程包含</span><br><span class="line"><span class="symbol">inurl:</span>/path_to_qnews/q-news.php?id=  远程包含</span><br><span class="line"><span class="symbol">inurl:</span>/inc/backend_settings.php?cmd=</span><br><span class="line"><span class="symbol">inurl:</span>login.action strus2系列执行漏洞利用</span><br><span class="line"><span class="symbol">inurl:</span>php?x=                 <span class="symbol">inurl:</span>php?open=</span><br><span class="line"><span class="symbol">inurl:</span>php?visualizar=        <span class="symbol">inurl:</span>php?pagina=</span><br><span class="line"><span class="symbol">inurl:</span>php?inc=               <span class="symbol">inurl:</span>php?include_file=</span><br><span class="line"><span class="symbol">inurl:</span>php?page=              <span class="symbol">inurl:</span>php?pg=</span><br><span class="line"><span class="symbol">inurl:</span>php?show=              <span class="symbol">inurl:</span>php?cat=</span><br><span class="line"><span class="symbol">inurl:</span>php?file=              <span class="symbol">inurl:</span>php?path_local=</span><br><span class="line"><span class="symbol">inurl:</span>php?filnavn=           <span class="symbol">inurl:</span>php?HCL_path=</span><br><span class="line"><span class="symbol">inurl:</span>php?doc=               <span class="symbol">inurl:</span>php?appdir=</span><br><span class="line"><span class="symbol">inurl:</span>php?phpbb_root_dir=    <span class="symbol">inurl:</span>php?phpc_root_path=</span><br><span class="line"><span class="symbol">inurl:</span>php?path_pre=          <span class="symbol">inurl:</span>php?nic=</span><br><span class="line"><span class="symbol">inurl:</span>php?sec=               <span class="symbol">inurl:</span>php?content=</span><br><span class="line"><span class="symbol">inurl:</span>php?link=              <span class="symbol">inurl:</span>php?filename=</span><br><span class="line"><span class="symbol">inurl:</span>php?dir=               <span class="symbol">inurl:</span>php?document=</span><br><span class="line"><span class="symbol">inurl:</span>index.php?view=        <span class="symbol">inurl:</span>*.php?locate=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?place=           <span class="symbol">inurl:</span>*.php?layout=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?go=              <span class="symbol">inurl:</span>*.php?catch=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?mode=            <span class="symbol">inurl:</span>*.php?name=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?loc=             <span class="symbol">inurl:</span>*.php?f=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?inf=             <span class="symbol">inurl:</span>*.php?pg=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?load=            <span class="symbol">inurl:</span>*.php?naam=</span><br><span class="line"><span class="symbol">allinurl:</span>php?page=           <span class="symbol">allinurl:</span>php?file= </span><br><span class="line"><span class="symbol">inurl:</span>php?x=                 <span class="symbol">inurl:</span>admin.php?cal_dir=</span><br><span class="line"><span class="symbol">inurl:</span>php?<span class="keyword">include</span>=           <span class="symbol">inurl:</span>php?nav=</span><br><span class="line"><span class="symbol">inurl:</span>*.php?sel=             <span class="symbol">inurl:</span>php?p=</span><br><span class="line"><span class="symbol">inurl:</span>php?conf=              <span class="symbol">inurl:</span>php?prefix=</span><br><span class="line"><span class="symbol">inurl:</span>theme.php?THEME_DIR= </span><br><span class="line"><span class="symbol">inurl:</span>php?lvc_include_dir=  </span><br><span class="line"><span class="symbol">inurl:</span>php?basepath=          <span class="symbol">inurl:</span>php?pm_path=</span><br><span class="line"><span class="symbol">inurl:</span>php?user_inc=          <span class="symbol">inurl:</span>php?cutepath=</span><br><span class="line"><span class="symbol">inurl:</span>php?fil_config=        <span class="symbol">inurl:</span>php?libpach=</span><br><span class="line"><span class="symbol">inurl:</span>php?pivot_path=        <span class="symbol">inurl:</span>php?rep=</span><br><span class="line"><span class="symbol">inurl:</span>php?conteudo=          <span class="symbol">inurl:</span>php?root=</span><br><span class="line"><span class="symbol">inurl:</span>php?configFile         <span class="symbol">inurl:</span>php?pageurl</span><br><span class="line"><span class="symbol">inurl:</span>php?inter_url          <span class="symbol">inurl:</span>php?url=</span><br><span class="line"><span class="symbol">inurl:</span>php?cmd=               <span class="symbol">inurl:</span>path.php?my=</span><br><span class="line"><span class="symbol">inurl:</span>php?xlink=             <span class="symbol">inurl:</span>php?to=</span><br><span class="line"><span class="symbol">inurl:</span>file.php?disp=</span><br></pre></td></tr></table></figure></p>
<p>找可能存在数据库注入各种参数:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>categorysearch.php?indus=</span><br><span class="line"><span class="symbol">intext:</span><span class="string">"樂天台東民宿網"</span> <span class="symbol">inurl:</span>news_board.php</span><br></pre></td></tr></table></figure></p>
<p>小商城类:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"View cart"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"Buy Now"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"add to cart"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"shopping"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"boutique"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"/store/"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"/shop/"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">".php?catid="</span> <span class="symbol">intext:</span><span class="string">"Toys"</span></span><br><span class="line"><span class="symbol">inurl:</span>details.php?BookID=</span><br><span class="line"><span class="symbol">inurl:</span>shop.php?<span class="keyword">do</span>=part&amp;id=</span><br></pre></td></tr></table></figure></p>
<p>普通cms类:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>article.php?ID=        <span class="symbol">inurl:</span>newsDetail.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>show.php?id=           <span class="symbol">inurl:</span>newsone.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>news.php?id=           <span class="symbol">inurl:</span>event.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>preview.php?id=        <span class="symbol">inurl:</span>pages.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>main.php?id=           <span class="symbol">inurl:</span>prod_detail.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>view.php?id=           <span class="symbol">inurl:</span>product.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>contact.php?Id=        <span class="symbol">inurl:</span>display_item.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>item.php?id=           <span class="symbol">inurl:</span>view_items.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>details.asp?id=        <span class="symbol">inurl:</span>profile.asp?id=</span><br><span class="line"><span class="symbol">inurl:</span>content.asp?id=        <span class="symbol">inurl:</span>display_item.asp?id=</span><br><span class="line"><span class="symbol">inurl:</span>view_detail.asp?ID=    <span class="symbol">inurl:</span>section.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>theme.php?id=          <span class="symbol">inurl:</span>produit.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>chappies.php?id=       <span class="symbol">inurl:</span>readnews.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>rub.php?idr=           <span class="symbol">inurl:</span>pop.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>person.php?id=         <span class="symbol">inurl:</span>read.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>reagir.php?num=        <span class="symbol">inurl:</span>staff_id=</span><br><span class="line"><span class="symbol">inurl:</span>gallery.php?id=        <span class="symbol">inurl:</span>humor.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>spr.php?id=            <span class="symbol">inurl:</span>gery.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>profile_view.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>fellows.php?id=        <span class="symbol">inurl:</span>ray.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>productinfo.php?id=</span><br><span class="line"><span class="symbol">inurl:</span>file.php?cont=         <span class="symbol">inurl:</span><span class="keyword">include</span>.php?chapter=</span><br><span class="line"><span class="symbol">inurl:</span>principal.php?param=</span><br><span class="line"><span class="symbol">inurl:</span>general.php?menue=     <span class="symbol">inurl:</span>php?pref=</span><br><span class="line"><span class="symbol">inurl:</span>nota.php?chapter=      <span class="symbol">inurl:</span>php?str=</span><br><span class="line"><span class="symbol">inurl:</span>php?corpo=             <span class="symbol">inurl:</span>press.php?*[*]*=</span><br></pre></td></tr></table></figure></p>
<p>除了上面这些常规找注入的方式,你不妨还可以像下面这样,直接在网页标题中搜SQL语句,说不定也会有收获哦,web万能的谷歌:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intitle:</span>注入常用的一些sql语句,比如<span class="symbol">:</span>常用的union,substr(),select等等……</span><br></pre></td></tr></table></figure></p>
<p>批量搜集万能密码(其实也属于sql注入的一种):<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span><span class="string">"wladmin/login.asp"</span>  </span><br><span class="line">Username : <span class="string">'='</span> <span class="string">'or'</span></span><br><span class="line">Password : <span class="string">'='</span> <span class="string">'or'</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span>POWERED BY Versatile Software Services       默认后台/alogin.aspx</span><br><span class="line">User ==&gt; <span class="string">'or'</span><span class="string">'='</span></span><br><span class="line">Pass ==&gt; <span class="string">'or'</span><span class="string">'='</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>/media.php?hal=login</span><br><span class="line"><span class="symbol">Email:</span> <span class="string">'='</span><span class="string">'or'</span>@gmail.com</span><br><span class="line"><span class="symbol">Pass:</span> <span class="string">'='</span><span class="string">'or'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">"Powered by : Best Webmasterz."</span> 默认后台/admin</span><br><span class="line">User : <span class="string">'='</span> <span class="string">'OR'</span></span><br><span class="line">Pass : <span class="string">'='</span> <span class="string">'OR'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">"Web Design and Maintenance by Cloud 5 Solutions"</span> 默认后台/admin/login.php</span><br><span class="line">User : <span class="string">'='</span> <span class="string">'OR'</span></span><br><span class="line">Pass : <span class="string">'='</span> <span class="string">'OR'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">"网站设计：火龙科技"</span> 默认后台/maintain/login.php</span><br><span class="line">Username : <span class="string">'='</span> <span class="string">'or'</span></span><br><span class="line">Password : <span class="string">'='</span> <span class="string">'or'</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intext:</span><span class="string">"Powered by Moodyworld"</span> 默认后台/admin/</span><br><span class="line">Username : <span class="string">'='</span> <span class="string">'or'</span></span><br><span class="line">Password : <span class="string">'='</span> <span class="string">'or'</span></span><br></pre></td></tr></table></figure>
<p>找遗留的各种数据库报错,物理路径,数据库版本,服务器探针类文件等等……<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">site:</span>*.tw  <span class="symbol">inurl:</span>/phpinfo.php</span><br><span class="line"><span class="symbol">filetype:</span>log <span class="string">"PHP Parse error"</span><span class="params">| "PHP Warning"</span></span><br><span class="line"><span class="params">site:*.tw  "id=" &amp; intext:"Warning: mysql_fetch_array()</span></span><br><span class="line"><span class="params">site:*.jp  "id=" &amp; intext:"Warning: getimagesize()</span></span><br><span class="line"><span class="params">site:*.br  "id=" &amp; intext:"Warning: array_merge()</span></span><br><span class="line"><span class="params">site:*.tw  "id=" &amp; intext:"Warning: mysql_fetch_assoc()</span></span><br><span class="line"><span class="params">site:*.tw  "id=" &amp; intext:"Warning: mysql_result()</span></span><br><span class="line"><span class="params">site:*.jp  "id=" &amp; intext:"Warning: pg_exec()</span></span><br><span class="line"><span class="params">site:*.tw  "id=" &amp; intext:"Warning: <span class="keyword">require</span>()</span></span><br><span class="line"><span class="params">inurl:/robots.txt site:*.*</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google mysql error.png" alt=""><br></p>
<p>搜集各种账号密码,比如,数据库密码,ftp,vpn,htpasswd,telnet等等……:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">可能会遗留的密码文件<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">inurl:</span>passlist.txt</span><br><span class="line"><span class="symbol">inurl:</span>password.txt</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">重要配置文件泄露<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">inurl:</span>/application/configs/  配置文件名为/application/configs/application.ini</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">htpasswd:</span></span><br><span class="line"></span><br><span class="line">htpasswd.bak <span class="symbol">filetype:</span>htpasswd</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vpn(cisco)[捅内网,非常有用]<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">filetype:</span>pcf  <span class="string">"GroupPwd"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cisco在线密码解密网站<span class="symbol">:</span></span><br><span class="line"><span class="symbol">https:</span>/<span class="regexp">/www.unix-ag.uni-kl.de/</span>~massar/bin/cisco-decode</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ftp 账号密码<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line"><span class="string">"index of/"</span> <span class="string">"ws_ftp.ini"</span> <span class="string">"parent directory"</span></span><br><span class="line"><span class="string">"your password is"</span> <span class="symbol">filetype:</span>log</span><br><span class="line"><span class="symbol">filetype:</span>ini <span class="symbol">inurl:</span><span class="string">"serv-u.ini"</span></span><br><span class="line"><span class="symbol">filetype:</span>ini <span class="symbol">inurl:</span>flashFXP.ini</span><br><span class="line"><span class="symbol">filetype:</span>ini ServUDaemon</span><br><span class="line"><span class="symbol">filetype:</span>ini wcx_ftp</span><br><span class="line"><span class="symbol">filetype:</span>ini ws_ftp pwd</span><br><span class="line"><span class="symbol">ext:</span>inc <span class="string">"pwd="</span> <span class="string">"UID="</span></span><br><span class="line">auth_user_file.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例如<span class="symbol">:</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.cryptoman.com/ftp</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">http:/</span><span class="regexp">/www.cryptoman.com/ftp</span><span class="regexp">/WS_FTP.ini</span></span><br></pre></td></tr></table></figure>
<p>其他密码:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">default password list	直接在谷歌中搜各类缺省用户名密码</span><br><span class="line">admin account info<span class="string">" filetype:log</span></span><br></pre></td></tr></table></figure></p>
<p>找目录遍历[上传点,数据库文件下载,phpmyadmin,网站后台及各种网站备份,源代码泄露等,同样也可以用这种方式慢慢找]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">site:</span>*.hk index of /admin</span><br><span class="line"><span class="symbol">site:</span>*.hk index of /upfiles</span><br><span class="line"><span class="symbol">site:</span>*.hk index of /fckeditor/editor/</span><br><span class="line"><span class="symbol">site:</span>*.tw index of /admin/uploadfile</span><br><span class="line"><span class="symbol">site:</span>*.tw index of /admin/file</span><br><span class="line"><span class="symbol">site:</span>*.tw index of /system/file</span><br><span class="line"><span class="symbol">site:</span>*.tw index of /phpmyadmin</span><br><span class="line"><span class="symbol">site:</span>*.tw index of /web/backup/</span><br><span class="line"><span class="symbol">inurl:</span>/phpmyadmin/index.php <span class="symbol">site:</span>*.tw</span><br></pre></td></tr></table></figure></p>
<p>搜同行们的各种工具脚本:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绝大部分人在用别人东西的时候,基本是很少看里面代码的[即使开源],更不要说去除特征及后门,没办法现状如此,大家都很懒,既是如此,就不免要把自己的成果也被迫的共享给别人一份,所以养成良好的读代码习惯,是非常有必要的</span><br></pre></td></tr></table></figure></p>
<p>搜同行的脱裤脚本:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">intitle:</span>登录 - Adminer    这里只是随便举个例子,你可以自己平时多搜集一些境内外常用的脱裤脚本的标题,文件名什么的,慢慢尝试,root空密码也很正常</span><br></pre></td></tr></table></figure></p>
<p>同样,你也可以用上面这种方式来找下别人的aspx嗅探脚本,例如:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">websniff</span><br></pre></td></tr></table></figure></p>
<p>找别人遗留的各种webshell,平时注意多搜集一些镜内外常用的大马特征,这里只是随便举几个例子,你可以随意组装自己的:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">inurl:</span>b374k.php <span class="symbol">filetype:</span>php</span><br><span class="line"><span class="symbol">inurl:</span>c99.php</span><br><span class="line"><span class="symbol">inurl:</span>c10<span class="number">0</span>.php Generation <span class="symbol">time:</span></span><br><span class="line"><span class="symbol">inurl:</span>itsecteam_shell.php</span><br><span class="line"><span class="symbol">intext:</span>x230<span class="number">0</span> Locus7Shell v. <span class="number">1.0</span>a beta Modded by</span><br><span class="line"><span class="symbol">intext:</span>c99shell <span class="symbol">inurl:</span>c99.php</span><br><span class="line">powered by Captain Crunch Security Team</span><br><span class="line"><span class="string">"inurl:c99.php"</span> + <span class="string">"intext:safe"</span></span><br><span class="line"><span class="symbol">intitle:</span>r57shell</span><br><span class="line"><span class="symbol">intitle:</span>c99shell +uname</span><br><span class="line"><span class="symbol">inurl:</span>c99.php uid=<span class="number">0</span>(root)</span><br><span class="line"><span class="symbol">intitle:</span>c99shell+<span class="symbol">filetype:</span>php</span><br><span class="line"><span class="symbol">intitle:</span>ly0kha shell</span><br><span class="line"><span class="symbol">inurl:</span>.php <span class="string">"cURL: ON MySQL: ON MSSQL: OFF"</span></span><br><span class="line"><span class="string">"Shell"</span> filetypehp <span class="symbol">intext:</span><span class="string">"uname -a:"</span> <span class="string">"EDT 2010"</span></span><br><span class="line"><span class="symbol">intitle:</span><span class="string">"intitle:r57shell"</span></span><br><span class="line"><span class="symbol">inurl:</span><span class="string">"c99.php"</span> &amp; <span class="symbol">intext:</span>Encoder Tools Proc. </span><br><span class="line"><span class="symbol">inurl:</span><span class="string">"c100.php"</span> &amp; <span class="symbol">intext:</span>Encoder Tools Proc. </span><br><span class="line"><span class="symbol">intitle:</span><span class="string">"Shell"</span> <span class="symbol">inurl:</span><span class="string">".php"</span> &amp; <span class="symbol">intext:</span>Encoder Tools Proc.</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/google webshell.png" alt=""><br></p>
<p>还有更多其他的工具特征,就留给大家自己去整理了,有时候站在别人的肩膀上上进去,感觉也挺好的…<br><br></p>
<p>找到目标的owa和vpn入口[内网入口]:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">owa入口<span class="symbol">:</span></span><br><span class="line">  <span class="symbol">inurl:</span>/owa/auth/logon <span class="symbol">intitle:</span>outlook</span><br><span class="line">  <span class="symbol">inurl:</span>/owa/auth/logon <span class="symbol">intext:</span>outlook</span><br><span class="line">   </span><br><span class="line">vpn入口<span class="symbol">:</span></span><br><span class="line">  <span class="symbol">inurl:</span>/sslvpn <span class="symbol">site:</span>hk</span><br></pre></td></tr></table></figure></p>
<p>找些好下手的目标子域:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">site:</span>polyu.edu.hk <span class="symbol">inurl:</span>asp?pid=</span><br><span class="line"><span class="symbol">site:</span>polyu.edu.hk <span class="symbol">inurl:</span>aspx?id=</span><br><span class="line"><span class="symbol">site:</span>polyu.edu.hk <span class="symbol">inurl:</span>php?id=</span><br><span class="line"><span class="symbol">site:</span>polyu.edu.hk <span class="symbol">inurl:</span>jsp?id=</span><br><span class="line"><span class="symbol">site:</span>polyu.edu.hk <span class="symbol">inurl:</span><span class="keyword">do</span>?id=</span><br><span class="line"><span class="symbol">site:</span>polyu.edu.hk <span class="symbol">inurl:</span>cgi?id=</span><br></pre></td></tr></table></figure></p>
<p>找目标的数据库备份及其它各类敏感文件目录[后缀一般为 sql,mdb,txt……],像数据库和网站备份这种东西,还是建议直接用工具跑比较好,前提是字典务必要精心制作:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">filetype:</span>sql <span class="symbol">inurl:</span>backup <span class="symbol">inurl:</span>wp-content</span><br><span class="line"><span class="symbol">inurl:</span>/eWebEditor/db/ <span class="symbol">site:</span>*.com</span><br></pre></td></tr></table></figure></p>
<p>从目标网站上搜集目标邮箱,说实话,目标自己网站上的邮箱价值一般都不是特别大:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">site:</span>*.gov.tw *@gov.tw</span><br></pre></td></tr></table></figure></p>
<p>关于google hacking的东西基本就到此为止了,最后再推荐一个不错的google dorks站点,方便大家练习:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span>/<span class="regexp">/cxsecurity.com/exploit</span><span class="regexp">/  非常推荐</span></span><br><span class="line"><span class="regexp">https:/</span><span class="regexp">/www.exploit-db.com/google</span>-hacking-database/ 并不推荐,exp不错,但这方面比较废</span><br></pre></td></tr></table></figure></p>
<p>关于谷歌的一些好玩的小玩具,无聊的时候可以自己玩玩,方法很简单,直接在谷歌里面搜下面的关键字就行了(说实话比百度人性多了):<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> a barrel roll</span><br><span class="line">Askew </span><br><span class="line">zerg rush</span><br><span class="line">google sphere</span><br><span class="line">atari breakout 图片碰碰球</span><br><span class="line">google gravity 碎片</span><br><span class="line">google sky</span><br><span class="line">blink html 抖动</span><br></pre></td></tr></table></figure></p>
<p>想必说到这里,你也已经大概能感受到google到底是有多强大了:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">错误配置,敏感文件目录,各种信息泄露(源码泄露,重要配置文件泄露,密码泄露等),批量漏洞利用,最强大的社工库资源等等……你在web上所能利用到的一切,无死角尝试就可以了</span><br></pre></td></tr></table></figure></p>
<p>其它的一些小恶作剧,也不小了,不要瞎弄,做错了事始终是要承担责任的:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">搜集个人身份证信息</span><br><span class="line"><span class="symbol">filetype:</span>xls 身份证 <span class="symbol">site:</span>cn</span><br><span class="line"></span><br><span class="line">搜集被盗QQ号什么的</span><br><span class="line">搜集别人还在有效期的信用卡,不过千万不要干坏事儿哦,不然后果你懂的……</span><br><span class="line"></span><br><span class="line">另外,还有图片识别,位置识别,谷歌为我提供了很多很强大的功能,有必要的话可以去深入学习下如何使用谷歌的这些api</span><br></pre></td></tr></table></figure></p>
<p><br><br>关于robots.txt文件的作用:<br>&nbsp;&nbsp;&nbsp;&nbsp;此文件一般位于网站根目录下,规定了搜索引擎不能爬行的一些目录,一般都是一些敏感目录,比如:后台,数据库连接配置文件,安装目录等等……一般我们在试了几个常用的后台目录都不行的情况,习惯性的就会直接去访问下目标的robots.txt文件,很可能这文件里面就存的有后台路径,但,那只是有可能,不尝试,连可能都没有<br><br></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/google-hacking/">google hacking</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/13/bypasscdn/">Web渗透第一步之信息搜集 [ 透过Cdn找目标真实ip ]</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-13
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 在了解cdn之前,有必要先来科普下什么是 ‘负载均衡’ 以及’正/反向’ 代理,既然选择了做渗透,这些最基本的基础不熟悉肯定是不行的</p>
<p>正向代理 [ ForwardProxy ]:<br>&nbsp;&nbsp;&nbsp;&nbsp;大家默认所说的代理其实都是指正向代理,不管是正向还是反向,理解数据的流向很重要,要理解这种比较抽象的东西最好的方式就是画图,比如下图就是一个正向代理的简易工作流程图,要表达的意思,已经很清晰了,就是说当客户端要去请求远程server上的资源时,并非直接通过本地路由网关到达远程server,而是先经过代理服务器,由代理服务器去帮我们请求,之后远程服务器会把请求的结果返回给代理服务器再由代理服务器返回给客户端,这么一个过程就叫正向代理,其实你还可以理解的更简单粗暴一点,它有点儿类似我们常说的 ‘翻墙’,正常情况我自己是不能直接上谷歌的,但我找了一个能上谷歌的代理,然后我们请求谷歌的时候可以让代理服务器去帮我们请求,最后,再通过代理服务器把响应的数据返回到我本地,就这么一个过程,包括我们常用的vpn其实也有点儿类似的功能(当然,这里只是粗略的类似,但vpn本质[隧道]上是什么,在前面已经有说明),不过现在正向代理可能用的比较少了,以前用代理服务器只是为了提高访问速度[因为缓存的原因],可以节省带宽,也可以在代理服务器上做些访问控制……</p>
    <!-- Only display the Read More link if we are displaying an excerpt -->
    
        <p id="readmore">
            <a href="/2014/12/13/bypasscdn/">
                Read More >>>
            </a>
        </p>
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/bypasscdn/">bypasscdn</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/12/subdomain-info-serarch/">web渗透第一步之信息搜集[子域,旁站,C段,AS号...]</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-12
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 为什么要从子域入手<br>&nbsp;&nbsp;&nbsp;&nbsp;如果我们的目标网络规模比较大,直接从目标主域入手显然是很不理智的,因为像这种规模的目标一般主域都是重点防护区域,与其浪费那个时间,不如先从目标的某个子域进去,然后再想办法迂回接近我们的真正目标,这样无疑是个比较好的选择,此时,也就不难理解那句话了,安全本就是一个全面立体的概念,单单只是边界几个点的安全,那不叫真正的安全</p>
<p>0x02 那么,现在问题来了,怎么尽可能多的搜集目标的高价值子域呢</p>
<p>0x03 利用dig 检查目标ns服务器是否允许传送<br>&nbsp;&nbsp;&nbsp;&nbsp;出于习惯性反应,首先,你应该去查下目标的ns服务器是否允许区域传送,如果允许,直接把目标的整个子域备份过来即可,后面将要说的所有步骤就可以直接全省了,关于dig和nslookup的使用非常简单,请自行查看其命令帮助或谷歌,实际测试中,个人还是更推荐用dig [毕竟是从权威dns查的,结果相对较准]</p>
<p>查出目标所有的ns记录,然后挨个尝试目标ns服务器是否允许传送[这里要注意,务必是目标自己的ns服务器,第三方的不算],虽然说,可能性不太大,但运气好也不一定呢,总之,没尝试之前谁也不知道<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig +short @8.8.8.8 cityu.edu.hk ns</span></span><br><span class="line">  vax.cityu.edu.hk.</span><br><span class="line">  cpccspc.cityu.edu.hk.</span><br><span class="line">  cpccux<span class="number">0</span>.cityu.edu.hk.</span><br></pre></td></tr></table></figure></p>
<p>通过上面的查询,我们确定了目标自己的三个ns服务器,下面就开始来尝试逐个传送,这里还是要注意,必须用目标自己的ns服务器来解析它自己的子域,如果还没搞清楚传送的具体原理,请务必先自行谷歌理解漏洞原理再来搞<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig +nocmd <span class="doctag">@vax</span>.cityu.edu.hk cityu.edu.hk axfr</span></span><br><span class="line"><span class="comment"># dig +nocmd <span class="doctag">@cpccspc</span>.cityu.edu.hk cityu.edu.hk axfr</span></span><br><span class="line"><span class="comment"># dig +nocmd <span class="doctag">@cpccux</span>0.cityu.edu.hk cityu.edu.hk axfr</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dig ns cityue.edu.hk axfr.png" alt=""></p>
<p>很显然,上面的这些ns服务器都不允许传送,为了给大家看看实际的传送效果,这里就给大家一个可以传送的实例<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig +nocmd <span class="doctag">@dns</span>2.communilink.net i-software.com.hk axfr</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dig axfr scuued.png" alt=""></p>
<p>0x04 从其他的各种记录中获取子域,如,mx记录,spf记录,srv记录…<br>&nbsp;&nbsp;&nbsp;&nbsp;如果目标ns服务器实在不允许传送,我们就要开始后面正常的流程了,之所以要查各种记录,因为从这里也能获取一些目标子域,虽然想借此直接下手的可能性不太大,但对我们来讲同样有用</p>
<p>查目标的mx记录<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dig +short cityu.edu.hk @8.8.8.8 mx</span></span><br><span class="line">  smtp.cityu.edu.hk</span><br></pre></td></tr></table></figure></p>
<p>0x05 各类子域搜集工具<br>&nbsp;&nbsp;&nbsp;&nbsp;既然不让传送,其实也没什么特别好的办法,无非就是靠爆破或者从各类搜索引擎上现抓取,对于这类的脚本,质量也是参差不齐,既然有成品,我们不妨就直接拿过来改吧改吧接着用,像这种小脚本,没必要非花那个时间去自己写 [当然,对于自己练练代码还是很有必要的],不过,还是要先说明下,既然是个人写的小脚本,报错,不稳定,程序异常,是常有的事,毕竟,没有经过很多人长时间的测试,但我们的要求是,能用,结果正确,相对稳定可靠即可,效率可暂时不做过多考虑</p>
<p>0x06 介绍几款自己常用的perl脚本,功能强大,且较稳定,不出意外的情况下,基本都是自己的首选</p>
<p>dnsenum 搜集信息比较规整,全面,如,ns,mx,a记录,自动尝试区域传送,也会从搜索引擎上抓取目标子域<code>不过早已不太好使了</code>,当上述动作执行完之后,即开始爆破,最后,把获取到目标的所有的域名所在的ip段以CIDR格式列出来,工具的整个执行流程跟我们之前手工的过程几乎是一模一样的,这也是为什么之前要先带大家手工走一遍的原因,这样非常有助于我们深入去理解工具,以后如果我们自己想写工具或者定制别人的工具这些都是一手参考样本<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常用选项<span class="symbol">:</span></span><br><span class="line">-t 		指定爆破线程</span><br><span class="line">--dnsserver 	指定用于查询的dns服务器地址</span><br><span class="line">-f 		指定子域字典</span><br><span class="line">--enum		三个选项的集合 --threads <span class="number">5</span> -s <span class="number">15</span> -w</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnsenum --dnsserver 8.8.8.8 --enum -f /usr/share/dnsenum/dns.txt cityu.edu.hk</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/dnsenum record.png" alt=""><br><img src="/img/dnsenum translate.png" alt=""><br><img src="/img/dnsenum domain.png" alt=""><br><img src="/img/dnsenum class c.png" alt=""></p>
<p>dnsmap 另一款比较好用的子域爆破工具,功能虽然没dnsenum那么多,但更加直观简洁,就是速度稍微有些慢,不过还好啦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-w 指定域名字典</span><br><span class="line">-r 指定结果存放位置</span><br><span class="line">-i 把泛解析,丢到指定的地址上</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># dnsmap cityu.edu.hk</span><br></pre></td></tr></table></figure>
<p><img src="/img/dnsmap.png" alt=""></p>
<p>fierce  功能基本同dnsenum,实际测试中,效果会更好一些,速度很快,结果相对比较准<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常用选项<span class="symbol">:</span></span><br><span class="line">-dns		指定要爆破的目标子域</span><br><span class="line">-dnsserver 	指定用域查询的dns服务器</span><br><span class="line">-threads	指定爆破线程</span><br><span class="line">-wordlist	指定域名字典</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fierce -dns cityu.edu.hk -dnsserver 8.8.8.8 -threads 20 -wordlist /usr/share/dnsenum/dns.txt</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/fierce res.png" alt=""><br><img src="/img/fierce class c.png" alt=""></p>
<p>0x07 其它的一些py子域爆破脚本:</p>
<p>后面的几个脚本基本都是用dnspython库写的,所以,这里事先安装下,不过,在最新版的kali,默认就已经装好了:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># apt-get install python-dnspython</span></span><br></pre></td></tr></table></figure></p>
<p>subbrute  说实话,并不怎么好用,速度慢,而且不太准,截取的信息也比较简陋,不过适合学习,关于此脚本库依赖,配置详情,请自行参考 <a href="https://github.com/TheRook/subbrute" target="_blank" rel="noopener">https://github.com/TheRook/subbrute</a><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">names.txt		子域字典</span><br><span class="line">resolvers.txt 		用于请求查询的dns服务器地址</span><br><span class="line">target.txt		准备好目标域名文件,可以同时跑多个子域</span><br><span class="line">-s 			指定自己的子域字典,默认会使用当前目录下的names.txt</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python subbrute.py -t target_domain.txt -c 16 -s /usr/share/dnsenum/dns.txt</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/subbrute.png" alt=""></p>
<p>subDomainsBrute  效果很一般,用的很少,关于此脚本依赖及配置,请参考 <a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">https://github.com/lijiejie/subDomainsBrute</a><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dns_servers.txt 存放用于请求的dns服务器地址,里面最好加上谷歌的<span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">-t 		指定扫描线程</span><br><span class="line">-f 		指定用于爆破的域名字典</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install dnspython gevent</span></span><br><span class="line"><span class="comment"># python subDomainsBrute.py -t 200 -f /usr/share/dnsenum/dns.txt cityu.edu.hk</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/subDomainBrute.png" alt=""></p>
<p>Sublist3r 跟上面的靠纯字典爆破不同的是,该脚本是现从各类搜索引擎中抓取的目标子域,想法还是很不错的,而且现从各种搜索引擎抓取的子域质量要比前面单纯靠爆破出来的也要高的多的多,尼玛,就是谷歌抓取一直都有问题<code>验证改的贼快,不靠人民币,看来是很难痛快的玩耍了</code>,另外,顺带的端口探测也是蛮不错的,较实用,对了,使用此脚本前务必先挂好vpn,你应该懂的,更多详情请参考 <a href="https://github.com/aboul3la/Sublist3r" target="_blank" rel="noopener">https://github.com/aboul3la/Sublist3r</a><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-d 	指定要爆破的目标子域</span><br><span class="line">-p 	扫描那些已经爆出来的子域所开放的端口</span><br><span class="line">-t 	指定爆破线程</span><br><span class="line">-e 	指定要爬取的搜索引擎,默认是从所有搜索引擎上抓取</span><br><span class="line">-b 	启用暴力破解模块</span><br></pre></td></tr></table></figure></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip install -r requirements.txt</span></span><br><span class="line"><span class="comment"># python sublist3r.py -d cityu.edu.hk -p 80,443,8080 端口不宜太多,不然速度会很慢</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/sublist3r.png" alt=""><br><img src="/img/sublist3r res.png" alt=""></p>
<p>0x08 前面基本都是一些在终端下跑的小脚本,下面再来介绍一款纯图形化的信息搜集工具[本身的功能还是非常实用的,抓取目标子域只是它的一个辅助小功能而已]foca [对于大型目标相对比较好使],它最开始是用来搜集目标站点的各种元数据的[至于元数据是什么,请自行谷歌],但现在开始逐渐支持常规的web漏洞扫描,错误配置扫描,自定义谷歌dorks,支持外部插件等等……,功能也已经趋于完善,而且纯图形化,配置选项[可使用google或者bing api]一目了然,相信大家一上手就会了,关键是能用它爬到我们想要的东西,最好再提醒一句,务必挂上vpn,谷歌可能有时还是用不了,尼玛<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">工具官方站点, <span class="symbol">https:</span>/<span class="regexp">/www.elevenpaths.com/labstools</span><span class="regexp">/foca/</span>   	可自行下载</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/foca.png" alt=""></p>
<p>0x09 相比之下,国内的朋友可能对seay的Layer 更熟悉,说实话,我自己确实用的比较少,总体来讲,还不错,除了爆破,顺便还会把响应头中的各字段数据也截取一下,使用非常简单,调好线程,纯图形界面也比较友好……给个目标子域,跑起来即可,字典文件和程序在同目录,如果你觉得它的字典质量不高,可以自己往里面加一些子域名,或者干脆用自己的字典,说实话,实际测试效果很一般<br><img src="/img/layer.png" alt=""></p>
<p>0x10 有些大公司基本一个C段都是他自己的,这都比较正常,所以,直接找下C端的目标web也未尝不可,有机会还是能直接跨过去的<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># masscan -p 80,81,82,443,8080,8081 144.214.2.0/24 --rate=100</span></span><br></pre></td></tr></table></figure></p>
<p>0x11 另外,如果目标规模真的是特别大的情况下,可以从AS号反查目标对应的ip段,然后再从这些段里面入手,也是靠谱的,有很多类似功能的反查站点,大家去谷歌搜搜,肯定一大堆<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://asnip.net/</span><br></pre></td></tr></table></figure></p>
<p>0x12 如果你实在不太相信这类工具的话,<code>比如我</code>,也可以自己手工在bing,google,shodan…上慢慢翻,反正我们的最终目的只是想尽快随便找个目标子域先进去,工具有时候不见得会快很多,而且工具暂时还不具备人的经验判断的,经常跑出来很多没用的东西,虽然,手工找,可能稍微繁琐点,但往往更精准,总体算来效率还是高的,而且找到的东西往往更有价值<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">site:</span>*.cityu.edu.hk 	谷歌,bing找子域</span><br><span class="line"><span class="symbol">hostname:</span><span class="string">"cityu.edu.hk"</span> shodan可能效果会更好一点</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>0x13 我们通常需要重点关注的一些目标子域,总结的不是很全,一下子暂时就想到这么些,大家自己慢慢拓展吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">内部oa系统</span><br><span class="line">类似citrix的各种虚拟化办公系统</span><br><span class="line">监控系统</span><br><span class="line">日志搜集系统</span><br><span class="line">crm系统</span><br><span class="line">cmdb系统</span><br><span class="line">mail系统</span><br><span class="line">一些用于内部测试的目标站点,正常情况下,新功能上线一般都会先丢到测试机器上跑跑,没问题才会更新到线上,既是测试站点,防御自然也相对薄弱</span><br><span class="line">一些老旧目标站点,有些目标站可能年头有些久,但由于业务的问题暂时又不能关闭,这也是一些相对比较好下手的地方</span><br><span class="line">一些可能用于备份的机器,比如,边界的NFS,Rsync之类的</span><br><span class="line">各类java控制台</span><br><span class="line">各类服务器web管理面板</span><br><span class="line">各类路由web管理面板</span><br><span class="line">一些带有各类远程执行漏洞的特定版本的web中间件,比如,IIS6.0,Tomcat,jboss...</span><br><span class="line">一般从子域命名大致都能看的出来,诸如,oa,zabbix,nagios,cacti,erp,sap,crm,cmdb,old,bakup,test...直接尝试针对这些的各类漏洞利用</span><br><span class="line">所以,这个域名字典务必要有很强的针对性,最好花点时间自己好好整理一份留着,不然也很难跑出来我们想要的东西...</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>搜集目标子域小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;有时候,比如,当你直接跑test.org子域同时跑出来了os.test.org和monitor.os.test.org,这时你不妨尝试再把os.test.org当子域跑跑,说不定从这个子域下又会有不少收获,不过上面有些脚本也会自动遍历多级子域,这确实是个不错的切入点,可能还有些泛解析的问题,不过那些问题不太大,关于子域的各类查找手段,暂时就这些了,不管是爆破还是现从各种搜索引擎上抓取,我们最终目的只是为了想法设法接近我们真正的目标或者拿到一个边界入口,为我们后续方便进入目标内部先铺好路,工具仅仅只是为了辅助我们快速完成这一目的,并非决定性因素,所以大可不必在这类的工具上花太多时间,知道你自己想要的是什么就好了,还是那句话,你所搜集的每一个信息都有它存在的价值和意义,不要盲目,切记,从上面我们不难看到,反而是越大的目标,能入手的点就越多,废话不多说,祝大家好运吧 ^_^ ,最后觉得还是要再提醒大家一下,这里只是为了给大家更直观的说明,才不得不用了一些真实站点,希望大家不要恶意破坏,否则,后果自负<br><br></p>
<h5 id="搜集目标的C段旁站信息-主要针对某些小型单个目标站点"><a href="#搜集目标的C段旁站信息-主要针对某些小型单个目标站点" class="headerlink" title="搜集目标的C段旁站信息 [主要针对某些小型单个目标站点]:"></a>搜集目标的C段旁站信息 [主要针对某些小型单个目标站点]:</h5><p>0x01 什么是旁站<br>&nbsp;&nbsp;&nbsp;&nbsp;和搜集子域的情况类似,我们的直接目标站做的比较到位,从目标站本身基本上找不到什么比较好的入手点,这时候,如果想要快速拿下目标的话,一般都会先找个目标站点所在服务器上其他的比较好搞的站下手,然后再想办法跨到真正目标的站点目录中,前提是有权限,如果实在跨不过去,就只能想办法先提权[说实话,虚拟机其实是比较难提的]了,拿到服务器的最高权限以后就可以对目标站为所欲为了,一般我们把这种渗透方式就叫旁站,至于渗透同服其它网站的方法,和常规的web渗透并没什不同,只是相当于绕了个路进去的而已,关于web渗透,后续还会有大量的篇幅专门来说明,这里先不用着急<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">旁站: 和目标网站在同一台服务器上的其它的网站</span><br></pre></td></tr></table></figure></p>
<p>0x02 什么是C段<br>&nbsp;&nbsp;&nbsp;&nbsp;和旁站差不多的是,旁站是通过同一台服器上的其它网站跨到目标站的目录里,而C段,则是通过目标所在C段的其他任意一台机器,想办法跨到我们的目标机器上,至于怎么跨,嗅探,社工,web……随你便,反正最终目的能跨过去即可,实战可能还会有个问题就是,你搞下的一台目标C段机器在内网,也就是说它根本没有公网ip[靠路由映射进去的],像如果是这种情况,这台机器对你就没什么价值了,另外,如果是虚拟机,这种方式可能也不太好使,因为光提权就比较困难,这只是其中一个问题,很多其它的问题,我们暂时先不说,后续碰到再详细说,这里先理解一下基础概念即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C段: 和目标机器ip处在同一个C段的其它机器,即都在同一个交换机下</span><br></pre></td></tr></table></figure></p>
<p>0x03 关于旁站/C段工具的基本编写原理<br>&nbsp;&nbsp;&nbsp;&nbsp;现在市面上这类的工具也是多如牛毛,但各有优劣(可能是接口质量的差别吧),但大多数都是用bing的接口,把查询到的结果数据中的旁站链接提取出来,C段和旁站唯一不一样的地方,就是C段是把整个段的ip上的旁站都轮询一遍,不过在此之前你需要先申请一下bing的搜索api,其实我自己都是选择性的用,因为不太准,手工直接在bing里面翻翻可能就有了,因为工具本身有时可能会漏掉很多有价值的参考信息,反正我们的目的就是随便找个能进去的站即可,怎么找,随意,你自己觉得怎么快就怎么来,渗透在乎更多的是结果和效率,过程几乎都不会太在意</p>
<p>0x04 好了,这部分内容确实比较简单,工具也没太多技术含量,单纯只是为了给大家理解一些基本概念而已,就不多说了</p>
<p>其实,还有非常多的一些提供类似功能的工具站,之前好用的,现在大多已经失效了,后期遇到好的再贴上来,大家可自行去谷歌上搜搜,确实挺多的,不过大部分似乎并不太好用,另外,大家如果有任何问题或者建议,也可直接私信我,其实,我一直都在<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.sameip.org/</span></span><br></pre></td></tr></table></figure></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/search-info/">search info</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/11/search-ipinfo/">Web渗透第一步 之 信息搜集 [ 搜集目标真实Ip信息 ]</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-11
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 在实际渗透中,给我们的目标可能仅仅就是一个域名或者某个组织名,那么该如何仅仅通过一个目标域名或者组织域名来确定目标所在的一些真实ip段呢,下面我们就开始整个信息搜集任务的第一步,搜集目标ip及域名信息,注意,这里我们暂且先不考虑目标是否用了CDN的问题,如何透过cdn找真实ip在后面会做单独说明,这里就先以正常的情况来说明</p>
<p>0x02 以<code>www.cityu.edu.hk</code> 为例,拿到目标域名的第一反应,没别的,先ping下目标域名看看解析情况再说<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping www.cityu.edu.hk</span></span><br><span class="line">www.cityu.edu.hk (<span class="number">144.214</span>.<span class="number">5.62</span>) ping 目标主域解析到的ip是这个</span><br></pre></td></tr></table></figure></p>
<p>0x03 虽然没ping通,但这并不影响我们看它解析到的ip,不通的原因,还要看它提示的是什么,如果是超时,多半是因为防火墙拦截了imcp请求,不过这并不是重点,重点是我们已经发现这个域名被解析到了这个ip上,而且被解析的这个域名依然是 <a href="http://www.cityu.edu.hk,其实,从这里基本就已经可以确定这个ip就是目标的真实ip段内的[搞多了,自然就会有感觉],不信的话,我们可以直接尝试在浏览器中访问下解析到的这个ip,看看是不是会自动跳转到www.cityu.edu.hk" target="_blank" rel="noopener">www.cityu.edu.hk,其实,从这里基本就已经可以确定这个ip就是目标的真实ip段内的[搞多了,自然就会有感觉],不信的话,我们可以直接尝试在浏览器中访问下解析到的这个ip,看看是不是会自动跳转到www.cityu.edu.hk</a> 这个域名上的网页上,但仅仅就这一个ip还是远远不够的,对一个这种规模的大学来讲,机器肯定不再少数,我们接着往下走……<br><img src="/img/www.cityu.edu.hk.png" alt=""><br></p>
<p>0x04 ping 完主域,顺手再来ping下子域,依然是没ping通,不过我们看到这个子域也被解析到了这个ip上[很可能是代理服务器或者负载均衡器什么的]<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping cityu.edu.hk</span></span><br><span class="line">cityu.edu.hk (<span class="number">144.214</span>.<span class="number">5.62</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/cityu.edu.hk.png" alt=""></p>
<p>0x05 通过上面简单的ping,我们已初步发现目标所在的其中一个真实ip段,但仅仅只有这一个段还是远远不够的[像这种规模的大学,几乎整个B段都可能是它的],接着我们可以从目标的mx,ns,a记录入手,至于这些记录具体都是干什么的,这里就不细说了,大家请自行谷歌,因为我们今天的重点并不在这些记录本身,而仅仅是想通过这些记录[子域]获取一些目标的真实ip段,如下,推荐dig,nslookup不太准[非权威查询]<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查目标的mx记录<span class="symbol">:</span></span><br><span class="line"><span class="comment"># dig +short @8.8.8.8 cityu.edu.hk mx</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smtp.cityu.edu.hk (144.214.4.72)  </span><br><span class="line">很显然,这只是目标的一个子域,根据ping解析到的结果我们发现这个ip也确实是香港ip</span><br><span class="line">跟ping主域返回的结果是144.214.5.62,貌似是差了一个&apos;C&apos;段,不过,大致可以确定是目标的真实ip段</span><br></pre></td></tr></table></figure>
<p><img src="/img/cityu mx 1.png" alt=""><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cityu-edu-hk.mail.protection.outlook.com (<span class="number">65.55</span>.<span class="number">88.234</span>)  </span><br><span class="line">注意此域名,它并非目标子域,很显然是挂到outlook上的,ip也不是香港的</span><br><span class="line">所以,此ip对我们实际的渗透意义并不大,可以忽略</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/cityu mx 2.png" alt=""><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查目标ns记录<span class="symbol">:</span></span><br><span class="line"><span class="comment"># dig +short @8.8.8.8 cityu.edu.hk ns</span></span><br><span class="line">cpccspc.cityu.edu.hk (<span class="number">144.214</span>.<span class="number">5.254</span>) 目标子域,ip和主域处在同一C段中,可以确定为目标真实ip</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/cityu ns 1.png" alt=""></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vax.cityu.edu.hk (<span class="number">144.214</span>.<span class="number">2.1</span>) 目标子域,同处在B段中,初步确定为目标真实ip</span><br></pre></td></tr></table></figure>
<p><img src="/img/cityu ns 2.png" alt=""></p>
<p>cpccux0.cityu.edu.hk (144.214.5.253) 目标子域,ip和主域处在同一C段中,可以确定为目标真实ip<br><img src="/img/cityu ns 3.png" alt=""><br><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查目标a记录<span class="symbol">:</span></span><br><span class="line"><span class="comment"># dig +short cityu.edu.hk a</span></span><br><span class="line"><span class="number">144.214</span>.<span class="number">5.62</span>   和直接ping的结果一致,确定为真实ip</span><br></pre></td></tr></table></figure>
<p>0x06 当然,你可以从一些第三方网站上获取到目标的一些ip及域名信息,下面就推荐几个自己常用的<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip138的数据库还是蛮不错的,主要是更新频繁,只需提供一个目标ip或者域名[给子域就好了]即可定位ip所在地</span><br><span class="line">如果你想把它写到脚本中批量查,它也提供查询接口,付点儿费,然后把接口写到你的脚本中即可</span><br><span class="line">www.ip138.com</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/ip138 ip info res.png" alt=""><br><img src="/img/ip138 ip info.png" alt=""></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这是个相对比较老的信息搜集站,直接给个目标子域,它会把目标的一些子域也都列出来</span><br><span class="line">然后你可以挨个点到每个子域里面再去看该子域详情,域名详情包括这个域名ip变更的历史记录</span><br><span class="line">[比如,我们发现在www.cityu.edu.hk这个域名上曾经解析到过三个ip,尝试ping下以前的ip看看还在不在</span><br><span class="line">说不定是个入手点呢],web服务器版本型号,操作系统类型[如果是一些低版本的操作系统,我们可以直接尝试比较经典的漏洞exp,比如iis(<span class="number">2000</span> <span class="number">2003</span>)写等等……]</span><br><span class="line">域名注册商[如果你想做域名劫持可能会用到],域名所在地等等……</span><br><span class="line">从结果看到我们看到,主域其实是一台f5负载均衡设备[印证了前面的猜测]</span><br><span class="line">另外从别的子域里面我们又发现了很多其它的真实ip段</span><br><span class="line">www.netcraft.com</span><br></pre></td></tr></table></figure>
<p><img src="/img/netcraft.com.png" alt=""><br><img src="/img/netcraft.com res.png" alt=""></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最后再来查下目标域名的 whois 信息,里面的一些内容对我们渗透也是有一定帮助的,比如,注册时留下的各种联系信息,邮箱,电话,姓名等等...</span><br><span class="line">www.whois.com/whois</span><br></pre></td></tr></table></figure>
<p>whois里面对我们有用的信息可能也就下面这些:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注册信息中的邮箱,名字,域名注册时间,过期时间以及当前注册状态</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Registrant Contact Information.png" alt=""><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">管理员各种联系信息,包括管理员邮箱电话,传真,各种名字[可以用来制作字典]</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Administrative Contact.png" alt=""><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">目标技术的联系方式,包括邮箱,电话,传真,名称</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Technical Contact.png" alt=""><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用于解析该域名的所有ns服务器,从这里面我们发现了两个我们之前在ns记录没查到的域名,不过一看,这很显然就不是目标自己的ns服务器,所以,忽略</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/Name Servers Information.png" alt=""></p>
<p>0x07 通过上面的初步搜集,我们大致整理出了下面的一些目标真实ip段,因为段比较多,这里并没有都写上去……,关键是大家的搜集思路清晰就好:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">144.214</span>.<span class="number">2.0</span>/<span class="number">24</span></span><br><span class="line"><span class="number">144.214</span>.<span class="number">4.0</span>/<span class="number">24</span></span><br><span class="line"><span class="number">144.214</span>.<span class="number">5.0</span>/<span class="number">24</span></span><br><span class="line"><span class="number">144.214</span>.<span class="number">236.0</span>/<span class="number">24</span></span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p>0x08 到这一步,初步的ip及域名信息搜集就基本算是完成了,内容确实比较简单,关于工具的使用也比较容易,实在不会,看看命令的相关帮助应该就能明白了,可能最需要注意的地方还是 ping 的时候最好多ping几次,有时候因为自己的网速或者目标的网络问题,也会导致超时,并非一定是防火墙的原因,所以,一般ping 个5,6次就差不多了,当然,这里只是大家告诉你怎么手工去找,相信这里的一点铺垫,到后面会更利于你去理解和使用这一类的信息搜集工具,因为它们的工作流程大致都是如此,只不过我们现在是在手工实现它,还是那句话,实际渗透中怎么快怎么来[以效率为重],后面会说到dnsenum,一个脚本基本就可以把上面说的东西全干了……</p>
<p>0x09 当然啦,这仅仅还是万里长征的第一步,拿到准确的目标ip段信息,也是为了方便我们后面,对目标机器大概的部署情况做一些简要判断,从中找到一些可能的突破口,这中间还会涉及到cdn的问题,不过不用太着急,后面会再专门针对cdn做单独的详细说明,至于拿到这些真实ip信息以后的事情,就自己随意了,旁站,C段,ddos,爆破…………,自己想怎么发挥都行…</p>
<p>小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;没啥技术含量,方便加深对此类工具的深层理解,顺带留给有需要的朋友<br><br></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/信息搜集/">信息搜集</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/信息搜集/">#信息搜集</a>
</div>




</div>
</div>


    <div class="main">
<div class="blog-post">
    <!-- Title -->
    
      <h1 class="blog-post-title">
        <a href="/2014/12/10/hidsdesd-vpn/">OpenVpn 安全部署实战指南 [一]</a>
      </h1>
    
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2014-12-10
        
            by klion
        
    </p>

    

    <!-- Content -->
    <p><br><br>0x01 关于openvpn<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">一种基于OpenSSL加密库的开源VPN实现,此处的主要目的还是旨在说明如何快速安全部署openvpn</span><br><span class="line">关于其内部的加解密细节及封装与解封装过程,相信大家都已经比较熟练了,此处不做过多涉及,暂以实战上手应用为主</span><br></pre></td></tr></table></figure></p>
<p>0x02 openvpn 可工作于两种不同的模式,使用 TUN / TAP 作为接口建立隧道,但需要相应内核支持<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TUN 接口创建的是三层路由隧道,实际中用的较多,TAP 是二层网卡桥接隧道,即创建一个以太网桥接,相对复杂</span><br><span class="line">TAP 接口的好处在于,客户端可以获得 VPN 服务器所处子网的 IP [即,忽略物理上的区别,可以完全将客户端看做是与VPN服务器处于同一子网的另一台机器]</span><br><span class="line">而TUN 接口下所有的客户端则处于一个完全独立的子网内,与 VPN 服务器所在的子网没有关系,待到后面实际部署时,会深有体会的</span><br></pre></td></tr></table></figure></p>
<p>0x03 下面则是 openvpn 提供的两种安全模式<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Static Key</span><br><span class="line">X509 PKI [Public Key Infrastructure]</span><br></pre></td></tr></table></figure></p>
<p>此次演示环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OpenVpnServer  	  ip: 192.168.3.71 [假设为公网ip]   ip: 192.168.6.39 [假设为其所在的内网ip] ip: 192.168.7.39 [假设为其所在的另一个内网ip]</span><br><span class="line">OpenVpnClient	  ip: 192.168.6.41 [内网ip] 	   ip: 192.168.7.41 [另一个内网ip段]	为OpenVpnServer所在内网段的一台linux机器</span><br><span class="line">win7cn		  ip: 192.168.32.253 [本地机器的内网ip] 作为连接OpenVpnServer的windows访问客户端</span><br><span class="line">CentOS6.8_x86_64  ip: 192.168.32.136 [本地机器的内网ip] 作为连接OpenVpnServer的linux访问客户端</span><br></pre></td></tr></table></figure></p>
<p>我们要实现的最终目的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过拨入 OpenVpnServer 可在本地直接访问远程内网,即`192.168.32.x`和`192.168.6.x`,本身是两个完全独立相互不同的内网段</span><br><span class="line">但现在要实现的效果就是,可以直接在win7cn或者CentOS6.8上ping通OpenVpnServer所在内网中的OpenVpnClient机器</span><br></pre></td></tr></table></figure></p>
<p>0x04 Ok,明确了最终目的之后,我们就开始来实战部署OpenVpn</p>
<p>首先,进行一些前期的必要环境准备,务必严格保证所有机器时间完全一致,此项非常重要,否则后期OpenVpn客户端在连服务端时会出现证书无法被验证的情况<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/sbin/ntpdate time.nist.gov  先手工在所有机器上同步一次,之后再加到计划任务中自动同步即可</span></span><br><span class="line"><span class="comment"># crontab -e</span></span><br><span class="line">  *<span class="regexp">/2 * * * * /usr</span><span class="regexp">/sbin/ntpdate</span> time.nist.gov &gt; <span class="regexp">/dev/null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="comment"># crontab -l</span></span><br></pre></td></tr></table></figure></p>
<p>安装C编译器及openssl加密库,众所周知,openvpn依赖openssl对隧道数据进行加密<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y  gcc gcc-c++ openssl openssl-devel</span><br></pre></td></tr></table></figure></p>
<p>禁用selinux,之后一定要记得重启下系统,才可生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># setenforce 0</span><br><span class="line"># sed -i &apos;/^SELINUX=/c\SELINUX=disabled&apos; /etc/selinux/config</span><br><span class="line"># shutdown -r now</span><br></pre></td></tr></table></figure></p>
<p>准备好环境所需的源码包,此,分别为数据压缩库和openvpn自身的源码包<code>openvpn的下载地址可能已经被墙掉了,大家暂时挂ss下一下就好了</code><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget http://www.oberhumer.com/opensource/lzo/download/lzo-2.06.tar.gz</span></span><br><span class="line"><span class="comment"># wget https://build.openvpn.net/downloads/releases/openvpn-2.2.2.tar.gz</span></span><br></pre></td></tr></table></figure></p>
<p>编译安装LZO,主要用它来压缩通信数据加快传输速度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># tar xf lzo-2.06.tar.gz</span><br><span class="line"># cd lzo-2.06</span><br><span class="line"># ./configure &amp;&amp; make &amp;&amp; make install</span><br><span class="line"># echo $?</span><br></pre></td></tr></table></figure></p>
<p>0x05 编译安装OpenVPN,记得要载入lzo一起编译<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar -zxf openvpn-2.2.2.tar.gz</span></span><br><span class="line"><span class="comment"># cd openvpn-2.2.2</span></span><br><span class="line"><span class="comment"># ./configure --with-lzo-headers=/usr/local/lzo/include --with-lzo-lib=/usr/local/lzo/lib</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br><span class="line"><span class="comment"># echo $?</span></span><br><span class="line"><span class="comment"># which openvpn  如果能看到路径,说明openvpn已经基本安装成功,默认是在/usr/local/sbin/openvpn目录下</span></span><br></pre></td></tr></table></figure></p>
<p>0x06 安装成功后,我们就开始来实际部署配置OpenVpn</p>
<p>首先,修改默认证书信息,而后,以此来创建各种证书<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># cd /root/openvpn-2.2.2/easy-rsa/2.0/ &amp;&amp; ll</span><br><span class="line"># cp vars vars.bak</span><br><span class="line"># vi vars</span><br><span class="line">  export KEY_COUNTRY=&quot;CN&quot;</span><br><span class="line">  export KEY_PROVINCE=&quot;BJ&quot;</span><br><span class="line">  export KEY_CITY=&quot;BeiJing&quot;</span><br><span class="line">  export KEY_ORG=&quot;klionsec&quot;</span><br><span class="line">  export KEY_EMAIL=&quot;klion@rootkit.org&quot;</span><br><span class="line">  export KEY_EMAIL=klion@rootkit.org</span><br><span class="line">  export KEY_CN=CN</span><br><span class="line">  export KEY_NAME=kliosec</span><br><span class="line">  export KEY_OU=klionsec</span><br><span class="line">  export PKCS11_MODULE_PATH=changeme</span><br><span class="line">  export PKCS11_PIN=1234</span><br><span class="line"># tail -n 11 vars</span><br><span class="line"># source vars	重新载入,让变量生效</span><br><span class="line"># ./clean-all  	把之前已有的证书全部先删掉</span><br><span class="line"># ./build-ca   	创建ca证书ca.crt 及根密钥ca.key [基本上一路按回车就好],因为在vars文件中已经定义好了默认的变量值,生成时会自动逐个读取</span><br><span class="line"># ll keys/   	看下刚刚生成的ca证书在keys目录里有没有</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/ca key.png" alt=""></p>
<p>创建服务端证书及密钥 <code>[ 中间会有一处让你输入密码,注意,后续创建证书时的密码最好都跟此密码保持一致,防止认证失败,之后再按照提示输入两次y即可]</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ./build-key-server server</span><br><span class="line"># ll keys/</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/server key.png" alt=""></p>
<p>创建完服务端证书和秘钥后,我们还需要为每一个登陆到OpenVpn服务器的客户端创建一个证书,注意直接用<code>build-key</code>创建的客户端证书默认是没密码的,也就是说,别人只要拿到你的这套客户端的证书就可以直接连上vpn服务器,有一定风险,当然,前提也得服务端配置中允许同一用户多点登陆才行,后续如果还要新增客户端用户,只需要再用build-key生成即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./build-key client  注意,这里也会提示输入密码,为了避免出问题,和上面创建服务端证书时设置的密码保持一致即可</span></span><br><span class="line"><span class="comment"># ll keys/</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/client key.png" alt=""><br><img src="/img/client key res.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ./build-key-pass clientsec 如果你想创建带密码的客户端证书,直接用 build-key-pass 来创建即可</span><br><span class="line"># ll keys/</span><br></pre></td></tr></table></figure>
<p><img src="/img/client key pass.png" alt=""><br><img src="/img/client key pass res.png" alt=""></p>
<p>创建秘钥交换协议文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ./build-dh    即迪菲·赫尔曼密钥,会生成dh1024.pem文件,生成过程可能会比较慢,在此期间不要去中断它</span><br><span class="line"># ll keys/</span><br><span class="line"># openvpn --genkey --secret keys/ta.key  生成ta.key文件,防DDos攻击,UDP淹没等恶意攻击,说实话,效果貌似并不太好</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dh1024 key.png" alt=""></p>
<p>0x07 创建并修改openvpn服务器配置文件,将需要用到的openvpn证书和密钥复制一份到创建好的keys目录中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -pv /etc/openvpn</span><br><span class="line"># cd /root/openvpn-2.2.2/easy-rsa/2.0</span><br><span class="line"># cp -ap keys/ /etc/openvpn/</span><br><span class="line"># cd ../../</span><br><span class="line"># cp sample-config-files/&#123;server.conf,client.conf&#125; /etc/openvpn/</span><br><span class="line"># tree /etc/openvpn/</span><br><span class="line"># cd  /etc/openvpn/</span><br><span class="line"># cp -a server.conf server.conf.bak</span><br><span class="line"># grep &apos;^[^#;]&apos; /etc/openvpn/server.conf &gt; tmp.txt</span><br><span class="line"># cat tmp.txt &gt; server.conf</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 下面是openvpn服务端的完整配置</span><br><span class="line"># vi server.conf</span><br><span class="line">  local 192.168.3.71			 # 要绑定到的公网ip</span><br><span class="line">  port 11941				 # openvpn服务的默认端口,最好改掉,其实,别人如果全端口扫描还是能扫到 </span><br><span class="line">  proto tcp				 # 使用tcp协议,相对稳定</span><br><span class="line">  dev tun				 # 此处使用tun接口</span><br><span class="line">  ca /etc/openvpn/keys/ca.crt		 # ca证书路径</span><br><span class="line">  cert /etc/openvpn/keys/server.crt	 </span><br><span class="line">  key /etc/openvpn/keys/server.key	 # openvpn服务端证书路径 </span><br><span class="line">  dh /etc/openvpn/keys/dh1024.pem	 </span><br><span class="line">  server 10.18.0.0 255.255.255.0	 # openvpn内网ip地址池 </span><br><span class="line">  push &quot;route 192.168.6.0 255.255.255.0&quot; # 此项非常重要,即vpn服务器所在的内网段</span><br><span class="line">  push &quot;route 192.168.7.0 255.255.255.0&quot; # 如果想让别人拨入成功后能直接跟vpn所在的内网段的机器进行通信,就需要用此方式把配置推到每个客户端</span><br><span class="line">  client-to-client			 # 让openvpn客户端和客户端能相互通信</span><br><span class="line">  duplicate-cn				 # 同一个vpn账号允许同时多点登陆,在上面已经提到过</span><br><span class="line">  ifconfig-pool-persist ipp.txt		 </span><br><span class="line">  keepalive 10 120			 # 发心跳包,每10一次,如果超过120秒都没动静,就自动断开</span><br><span class="line">  comp-lzo				 # 启用传输数据压缩</span><br><span class="line">  persist-key		</span><br><span class="line">  persist-tun				 </span><br><span class="line">  status openvpn-status.log		 # 开启OpenVpn服务端日志</span><br><span class="line">  log /var/log/openvpn.log		 # 指定日志存放位置</span><br><span class="line">  verb 3				 # 指定记录的日志级别</span><br></pre></td></tr></table></figure>
<p>0x08 修改完OpenVpn服务端配置后,我们再来稍微调整一些系统配置,如下</p>
<p>开启系统路由转发,因为在拨入成功后还要访问vpn服务器所在内网中的其它机器,所以转发是必须的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sed -i &apos;/net.ipv4.ip_forward/s/0/1/&apos; /etc/sysctl.conf</span><br><span class="line"># sysctl -p</span><br></pre></td></tr></table></figure></p>
<p>如果开了iptables,记得把tcp的11941端口<code>[实际中是你自己设置的openvpn服务端口]</code>和转发都放开,不然客户端可能会连不上,如果压根没开,可暂时不用管<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/sysconfig/iptables</span><br><span class="line">  -A INPUT -p tcp --dport 11941 -j ACCEPT</span><br><span class="line"># iptables -A INPUT -p tcp --dport 11941 -j ACCEPT</span><br><span class="line"># iptables -L -n</span><br><span class="line"># /etc/init.d/iptables status</span><br></pre></td></tr></table></figure></p>
<p>最后,我们来尝试启动OpenVpn服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># /usr/local/sbin/openvpn --config /etc/openvpn/server.conf &amp;</span><br><span class="line"># netstat -tulnp | grep openvpn</span><br><span class="line"># echo &quot;/usr/local/sbin/openvpn --config /etc/openvpn/server.conf &amp;&quot; &gt;&gt; /etc/rc.local</span><br><span class="line"># tail -n 1 /etc/rc.local</span><br><span class="line"># ifconfig  -a  openvpn服务一旦成功启动系统中就会多出一个名为tun0的虚拟网卡</span><br><span class="line"># pkill openvpn</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/openvpn start.png" alt=""><br><img src="/img/openvpn start res.png" alt=""></p>
<p>当然,除了手工去加载服务端配置文件来启动,你也可以用openvpn自己提供好的服务启动脚本来配置成常规启动,只是自己不太喜欢这样搞,过程非常简单,如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cp /root/openvpn-2.2.2/sample-scripts/openvpn.init /etc/init.d/openvpn</span><br><span class="line"># chmod 700 /etc/init.d/openvpn</span><br><span class="line"># chkconfig openvpn on</span><br><span class="line"># chkconfig --list</span><br><span class="line"># /etc/init.d/openvpn restart  会有报错</span><br><span class="line"># vi /etc/init.d/openvpn       把148行的*.conf改成server.conf,这个目录下不能有多个.conf否则就会被干扰到</span><br><span class="line"># /etc/init.d/openvpn restart  正常启动</span><br><span class="line"># lsof -i :1194</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/openvpn start initd.png" alt=""><br><img src="/img/openvpn start log.png" alt=""></p>
<p>0x09 把服务端完全搞定以后,我们再来看如何在不同系统平台下配置OpenVpn客户端进行连接</p>
<p>先下载并安装好 OpenVpn 的windows版客户端工具,地址已被墙<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://swupdate.openvpn.org/community/releases/openvpn-2.2.2-install.exe</span><br></pre></td></tr></table></figure></p>
<p>此时,再到OpenVpn服务端去把指定客户端的证书及配置文件都下载下来<code>[此处以client用户为例]</code>,之后再把这些文件全部复制到你OpenVpn客户端的config目录中,此处的OpenVpn客户端config目录是在如下的路径上,而你则要根据你自己的OpenVpn客户端安装目录来调整<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd /etc/openvpn/keys/</span><br><span class="line"># sz ca.crt client.crt client.key</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ca.crt client.crt client.key  	所有要复制的文件</span><br><span class="line">C:\Program Files\OpenVPN\config	要复制到的目录</span><br></pre></td></tr></table></figure>
<p><img src="/img/openvpn client install.png" alt=""><br><img src="/img/openvpn client install res.png" alt=""><br><img src="/img/openvpn client download.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 手工创建好客户端配置文件,文件具体内容如下,注意在windows中客户端配置文件名必须为 client.ovpn </span><br><span class="line"></span><br><span class="line">client			  # 声明是客户端</span><br><span class="line">dev tun			  # 和服务端保持一致,使用tun接口</span><br><span class="line">proto tcp		  # 同样使用tcp协议,保持一致,不然就没法和服务端进行正常通信了</span><br><span class="line">remote 192.168.3.71 11941 # Openvpn 服务端的ip和端口</span><br><span class="line">resolv-retry infinite</span><br><span class="line">nobind</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">ca ca.crt		  # 客户端证书所在路径</span><br><span class="line">cert client.crt</span><br><span class="line">key client.key</span><br><span class="line">ns-cert-type server</span><br><span class="line">comp-lzo		  # 压缩传输</span><br><span class="line">verb 3</span><br></pre></td></tr></table></figure>
<p>之后,再右键以<code>管理员权限</code>运行openvpn客户端,点击<code>connect</code> 进行连接即可,如下即表示连接成功,至此,整个OpenVpn的部署工作也就完成了百分之八十,但我们的最终目的是希望能在本地通过拨入vpn直接跟远程内网中的机器进行通信,再次明确目的之后,我们继续</p>
<p><img src="/img/openvpn client connect res.png" alt=""><br><img src="/img/openvpn client connect.png" alt=""></p>
<p>0x10 以上是使用windows客户端来连接OpenVpn服务端,至于如何在linux中使用客户端连接OpenVpn服务端就更简单了,跟OpenVpn服务端一样,先装好OpenVpn,之后只需用openvpn工具加载对应的客户端配置文件即可,注意,是客户端配置文件,另外,此处不需要再配置服务端,单单只是用下openvpn工具而已,具体如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># mkdir /etc/openvpn</span><br><span class="line"># cd /etc/openvpn</span><br><span class="line"># rz  可以直接把刚刚client的一套证书丢上去</span><br><span class="line"># tree ./</span><br><span class="line"> ├── ca.crt</span><br><span class="line"> ├── client.conf</span><br><span class="line"> ├── client.crt</span><br><span class="line"> └── client.key</span><br><span class="line"></span><br><span class="line"># 断开以后,第二次重连可能会有些问题,把客户端配置文件改个名就好了</span><br><span class="line"># /usr/local/sbin/openvpn --config /etc/openvpn/client.conf &amp;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/linux conenect in.png" alt=""></p>
<p>0x11 再回到我们的最终目的上,<code>如何在本地通过vpn直接跟远程内网进行通信</code>,方式大概有三种,如下</p>
<p>第一种,把所有要通信的远程内网中的机器的网关都指向OpenVpn服务器的ip,这样,包在回传的时候就能找到本地机器,为了防止重启即失效,可直接把命令放在<code>rc.local</code>中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># route add default gw 192.168.7.39  在OpenVpnClient上添加如下指向</span><br><span class="line"># route -n</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/openvpn in net .png" alt=""><br><img src="/img/openvpn in net res .png" alt=""></p>
<p>第二种,走网段路由,在所有要通信的内网的机器上添加如下路由,把来自vpn内网段的数据都直接丢到OpenVpn服务器指定的内网ip上,一样也可以达到目的,但两种方式有个共同的确定,机器比较少的情况下也许还能凑活,如果有几千台机器,每台上都要添加一条这样的指向毕竟是很不现实的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># route add -net 10.18.0.0/24 gw 192.168.7.39  在OpenVpnClient上添加如下指向</span><br><span class="line"># route -n</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/secode network.png" alt=""><br><img src="/img/secode network res.png" alt=""></p>
<p>所以,我们再来看第三种,利用iptables进行NAT转换,即把源地址为<code>10.18.0.0/24</code>都转换到指定的内网卡ip上,这样就不用再逐个指定网关了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/iptables status  只需在OpenVpnServer服务器上添加如下规则即可</span><br><span class="line"># /sbin/iptables -t nat -A POSTROUTING -s 10.18.0.0/24 -o eth2 -j SNAT --to-source 192.168.7.39	添加规则</span><br><span class="line"># /sbin/iptables -t nat -D POSTROUTING -s 10.18.0.0/24 -o eth2 -j SNAT --to-source 192.168.7.39	删除规则</span><br><span class="line"># /etc/init.d/iptables stop</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/iptables three.png" alt=""><br><img src="/img/iptables three res.png" alt=""></p>
<p>0x12 实际生产环境中,由于各种各样的原因,有时可能还需要禁止指定的客户端用户登陆,方法非常简单,直接注销指定的客户端证书,万一要连续禁用多个vpn账号,那就直接一次性注销多个客户端证书,执行revoke-full后直接覆盖原来的crl.pem文件即可,如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># cd /root/openvpn-2.2.2/easy-rsa/2.0</span><br><span class="line"># source vars</span><br><span class="line"># vi /root/openvpn-2.2.2/easy-rsa/2.0/openssl-1.0.0.cnf</span><br><span class="line"># tail -n 6 /root/openvpn-2.2.2/easy-rsa/2.0/openssl-1.0.0.cnf	先注释如下行</span><br><span class="line">  #[ pkcs11_section ]</span><br><span class="line">  #engine_id = pkcs11</span><br><span class="line">  #dynamic_path = /usr/lib/engines/engine_pkcs11.so</span><br><span class="line">  #MODULE_PATH = $ENV::PKCS11_MODULE_PATH</span><br><span class="line">  #PIN = $ENV::PKCS11_PIN</span><br><span class="line">  #init = 0</span><br><span class="line"># ./revoke-full client	指定要注销的客户端用户执行注销</span><br><span class="line"># cat keys/crl.pem</span><br><span class="line"># cat keys/index.txt	从该文件中可看到客户端用户的状态,R为已注销</span><br><span class="line"># cp keys/crl.pem /etc/openvpn/keys/</span><br><span class="line"># vi /etc/openvpn/server.conf	再到主配置文件中添加该pem文件位置,然后重启openvpn,该用户登陆即会失效</span><br><span class="line">  crl-verify /etc/openvpn/keys/crl.pem</span><br><span class="line"># /etc/init.d/openvpn restart</span><br></pre></td></tr></table></figure></p>
<p>下面是vpn账户被禁用后再登陆的效果,你会发现客户端的连接在一直被reset掉</p>
<p><img src="/img/client error.png" alt=""></p>
<p><br></p>
<p>后话:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vpn作为直插目标内部的一个最直接的入口,也颇受入侵者的热爱,尤其是对各种APT团队来讲更是如此,针对此所进行的各种形式的钓鱼也从未休止</span><br><span class="line">其实,关于openvpn自身的漏洞并不多,甚至可以说,几乎没有,有也只是一些第三方库的,另外,基本也不存在什么错误配置能辅助我们渗透的</span><br><span class="line">关于openvpn的内部通信过程,大家可自行拿wireshark&amp;tcpdump仔细好好跟一下基本就看明白了,如果真想深入研究建议直接去阅读2.2的源码</span><br><span class="line">在部署上基本无任何技术含量,只是为了方便大家用,顺便给自己做个备忘,保证后续随时能用即可</span><br></pre></td></tr></table></figure></p>

    <!-- Only display the Read More link if we are displaying an excerpt -->
    

    <hr />

    


<div class="blog-categories-container">
    <span><img src="/image/categoriesicon.png" alt=""/></span> 
    <a href="/categories/vpn-config/">vpn config</a>
</div>


    


<div class="blog-tags-container">
    <span><img src="/image/tagsicon.png" alt=""/></span>
    <a href="/tags/openvpn/">#openvpn</a>
</div>




</div>
</div>




<div id="page-nav">
    <a class="extend prev" rel="prev" href="/page/14/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/16/">Next &raquo;</a>
</div>



  </div>
  <!-- Footer -->
  <div id="footer">
  <div id="footer-social">
    
    
    
    
    
    
</div>

  <p id="footer-info">
    &copy; 2018 APT-404<br>
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> -
    Theme <a href="https://github.com/Suolawangzai/hexo-theme-nebula" target="_blank">nebula</a>
  </p>

  <div id="busuanzi">
    <span id="busuanzi_container_site_pv">
      &hearts;
    Total visits: <span id="busuanzi_value_site_pv"></span>
    </span>
  </div>
  <!--
  <div id="footer-info">
    &copy; 2018 APT-404<br>
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
  </div>
-->
</div>

  <!-- After footer scripts -->
  <!-- Disqus Comments -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="/js/main.js"></script>

</body>

</html>
